!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=53)}([function(e,t,n){"use strict";(function(t){var r=n(5),o=n(13),i=n(2),a=n(10),s=n(20);global.rootPath=r.normalize(r.join(t,"..","..")),console.log("process.argv: "+process.argv);var u=void 0;u=process.argv.length>0?process.argv[1]:process.cwd(),global.rootPath=r.normalize(r.join(r.dirname(u),"..")),console.log("Application root path: "+global.rootPath),e.exports={isDevMode:function(){return!process.env.NODE_ENV||"development"===process.env.NODE_ENV},isProductionMode:function(){return"production"===process.env.NODE_ENV},isTestMode:function(){return"test"===process.env.NODE_ENV}};var c={},l=r.join(global.rootPath,"config.js");try{if(!o.existsSync(l)){console.warn(a.yellow.bold("External production configuration not found!. Create a default `config.js` file..."));var d=void 0;d=n(55),i.templateSettings.interpolate=/{{([\s\S]+?)}}/g;var p=i.template(d),f={hashSecret:s(),sessionSecret:s()};o.writeFileSync(l,p(f)),console.warn(a.green.bold("The `config.js` file created! Please update the settings in the file!"))}c=n(56)}catch(e){console.warn(a.red.bold("\r\n==============================================")),console.warn(a.red.bold("  Unable to load external `config.js` file!")),console.warn(a.red.bold(" ",e)),console.warn(a.red.bold("==============================================\r\n")),process.exit(1)}var m=n(57),v={};e.exports.isTestMode()?(console.log("Load test config..."),v=n(58),c={}):e.exports.isProductionMode()&&(console.log("Load production config..."),v=n(59)),e.exports=i.defaultsDeep(c,v,m,e.exports)}).call(t,"server/config")},function(e,t,n){"use strict";var r=n(60),o=n(5),i=n(13),a=n(28),s=n(0),u=[];if(u.push(new r.transports.Console({level:s.logging.console.level,colorize:!0,prettyPrint:!0,handleExceptions:"production"===process.env.NODE_ENV})),s.logging.logentries.enabled&&s.logging.logentries.token){console.log("Logentries log transport enabled!");n(61);u.push(new r.transports.Logentries({level:"debug",token:s.logging.logentries.token}))}if(s.logging.papertrail.enabled){console.log("Papertrail log transport enabled!"),n(62).Papertrail;var c=new r.transports.Papertrail(s.logging.papertrail);u.push(c)}if(s.logging.file.enabled){var l=s.logging.file.path;i.existsSync(l)||a(l),u.push(new(n(63))({filename:o.join(l,"server.log"),level:s.logging.file.level||"info",timestamp:!0,json:s.logging.file.json||!1,handleExceptions:!0})),s.logging.file.exceptionFile&&u.push(new r.transports.File({filename:o.join(l,"exceptions.log"),level:"error",timestamp:!0,json:s.logging.file.json||!1,prettyPrint:!0,handleExceptions:!0,humanReadableUnhandledException:!0}))}var d=new r.Logger({level:"debug",transports:u,exitOnError:!1});if(s.logging.loggly.enabled&&s.logging.loggly.token){console.log("Loggly log transport enabled!");n(64);d.add(r.transports.Loggly,{inputToken:s.logging.loggly.token,subdomain:s.logging.loggly.subdomain,tags:["vem-server"],json:!0})}if(s.logging.logsene.enabled&&s.logging.logsene.token){console.log("Logsene log transport enabled!");var p=n(65);d.add(p,{type:"vem-server",token:s.logging.logsene.token})}if(s.logging.logzio.enabled&&s.logging.logzio.token){console.log("Logz.io log transport enabled!");var f=n(66);d.add(f,{token:s.logging.logzio.token})}if(s.logging.graylog.enabled){console.log("Graylog log transport enabled! Servers: "+JSON.stringify(s.logging.graylog.servers));var m=n(67);d.add(m,{name:"Graylog",level:"debug",graylog:{servers:s.logging.graylog.servers,facility:"vem"}})}e.exports=d},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var r={};r.append=function(e,t){e.forEach(function(e){var n=e.toUpperCase();t&&(n=t+"_"+n),r[n]=e})},r.append(["admin","user","guest"],"ROLE"),r.append(["admin","owner","loggedIn","public"],"PERM"),r.append(["VALIDATION_ERROR","INVALID_CODE","MODEL_NOT_FOUND","ONLY_OWNER_CAN_EDIT_AND_DELETE"],"ERR"),e.exports=r},function(e,t,n){"use strict";var r=(n(0),n(1),n(3)),o=(n(13),n(5),n(2),n(22)),i=n(87),a=(n(8),n(6)),s=a.Schema,u=n(11)("users"),c=n(9),l={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},d=function(e){return"local"!==this.provider&&!this.updated||e.length},p=function(e){return"local"!==this.provider||e&&e.length>=6},f=new s({fullName:{type:String,trim:!0,default:"",validate:[d,"Please fill in your full name"]},email:{type:String,trim:!0,unique:!0,index:!0,lowercase:!0,default:"",validate:[d,"Please fill in your email"],match:[/.+\@.+\..+/,"Please fill a valid email address"]},username:{type:String,unique:!0,index:!0,lowercase:!0,required:"Please fill in a username",trim:!0,match:[/^[\w][\w\-\._\@]*[\w]$/,"Please fill a valid username"]},password:{type:String,default:"",validate:[p,"Password should be longer"]},passwordLess:{type:Boolean,default:!1},passwordLessToken:{type:String},provider:{type:String,default:"local"},profile:{name:{type:String},gender:{type:String},picture:{type:String},location:{type:String}},socialLinks:{facebook:{type:String,unique:!0,sparse:!0},twitter:{type:String,unique:!0,sparse:!0},google:{type:String,unique:!0,sparse:!0},github:{type:String,unique:!0,sparse:!0}},roles:{type:[{type:String,enum:[r.ROLE_ADMIN,r.ROLE_USER,r.ROLE_GUEST]}],default:[r.ROLE_USER]},resetPasswordToken:String,resetPasswordExpires:Date,verified:{type:Boolean,default:!1},verifyToken:{type:String},apiKey:{type:String,unique:!0,index:!0,sparse:!0},lastLogin:{type:Date},locale:{type:String},status:{type:Number,default:1},credentials:{access_token:{type:String},refresh_token:{type:String},token_type:{type:String},expiry_date:{type:Number},expires_in:{type:Number},id_token:{type:String}},metadata:{}},l);f.virtual("code").get(function(){return this.encodeID()}),f.plugin(c.plugin,{model:"User",startAt:1}),f.pre("save",function(e){var t=this;if(!t.isModified("password"))return e();i.genSalt(10,function(n,r){i.hash(t.password,r,null,function(n,r){t.password=r,e()})})}),f.methods.comparePassword=function(e,t){i.compare(e,this.password,function(e,n){t(e,n)})},f.virtual("avatar").get(function(){return this.profile&&this.profile.picture?this.profile.picture:this.email?"https://gravatar.com/avatar/"+o.createHash("md5").update(this.email).digest("hex")+"?s=128&d=wavatar":"https://gravatar.com/avatar/?s=128&d=wavatar"}),f.methods.encodeID=function(e){return e=e||this._id,u.encodeHex(e)},f.methods.decodeID=function(e){return u.decodeHex(e)};var m=a.model("User",f);e.exports=m},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("passport")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(10),a=n(6),s=n(9);e.exports=function(){var e=void 0;return r.info(),a.Promise=global.Promise,1!==a.connection.readyState?(r.info("Connecting to Mongo "+o.db.uri+"..."),e=a.connect(o.db.uri,o.db.options,function(e){if(e)return r.error("Could not connect to MongoDB!"),r.error(e);a.set("debug",o.isDevMode())}),a.connection.on("error",function(e){return"ETIMEDOUT"===e.message.code?(r.warn("Mongo connection timeout!",e),void setTimeout(function(){a.connect(o.db.uri,o.db.options)},1e3)):(r.error("Could not connect to MongoDB!"),r.error(e))}),s.initialize(e),a.connection.once("open",function(){r.info(i.yellow.bold("Mongo DB connected.")),r.info(),o.isTestMode()&&r.warn("Drop test database...")})):(r.info("Mongo already connected."),e=a),e}},function(e,t){e.exports=require("mongoose-auto-increment")},function(e,t){e.exports=require("chalk")},function(e,t,n){"use strict";var r=n(88),o=n(0);e.exports=function(e,t){return new r(e+o.hashSecret,t||10)}},function(e,t,n){"use strict";(function(t){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),u=(n(0),n(107).EventEmitter),c=n(5),l=(n(13),n(108),n(2)),d=n(10),p=n(19),f=(n(3),n(109)),m=n(14),v=n(16),h=n(111),g=(n(112),n(113).GraphQLScalarType,n(114).Kind),y=n(121),k=function(e){function u(){r(this,u);var e=o(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return e.setMaxListeners(0),e.app=null,e.db=null,e.services={},e}return i(u,e),a(u,[{key:"loadServices",value:function(e,r){var o=this;o.app=e,o.db=r;var i=function(t){var n=new y(t,e,r);o.services[n.name]=n};s.info(""),s.info(d.bold("Search built-in services..."));var a=n(125);a&&a.keys().map(function(e){s.info("  Load",c.relative(c.join(t,"..","services"),e),"service..."),i(a(e))}),s.info(""),s.info(d.bold("Search applogic services..."));var u=n(127);u&&u.keys().map(function(e){s.info("  Load",c.relative(c.join(t,"..","applogic","modules"),e),"service..."),i(u(e))}),l.forIn(o.services,function(e){l.isFunction(e.$schema.init)&&e.$schema.init.call(e,f.CreateToServiceInit(e))})}},{key:"registerRoutes",value:function(e){var t=this;l.forIn(this.services,function(n,r){if(!1!==n.$settings.rest&&n.actions){var o=p.Router();o.use(m.tryAuthenticateWithApiKey);var i=n.$settings.idParamName||"id",a=[];l.forIn(n.actions,function(r,u){var c=r.settings;if(c.handler=r,!l.isFunction(c.handler))throw new Error("Missing handler function in '"+u+"' action in '"+n.name+"' service!");var d=function(r,o){var i=f.CreateFromREST(n,c,e,r,o);s.debug("Request via REST '"+n.namespace+"/"+c.name+"' (ID: "+i.id+")",i.params),console.time("REST request"),t.emit("request",i);n.getCacheKey(c.name,i.params);Promise.resolve().then(function(){return i.resolveModel()}).then(function(){return i.checkPermission()}).then(function(){return c.handler(i)}).then(function(e){o.append("Request-Id",i.id),v.json(o,e)}).catch(function(e){s.error(e),v.json(o,null,e)}).then(function(){t.emit("response",i),console.timeEnd("REST request")})};switch(o.get("/"+u,d),o.post("/"+u,d),o.get("/:"+i+"/"+u,d),o.post("/:"+i+"/"+u,d),u){case"find":o.get("/",d);break;case"get":a.push({method:"get",path:"/:"+i,handler:d});break;case"create":a.push({method:"post",path:"/:"+i,handler:d}),o.post("/",d);break;case"update":a.push({method:"put",path:"/:"+i,handler:d}),a.push({method:"patch",path:"/:"+i,handler:d}),o.put("/",d),o.patch("/",d);break;case"remove":a.push({method:"delete",path:"/:"+i,handler:d}),o.delete("/",d)}}),a.forEach(function(e){o[e.method](e.path,e.handler)}),e.use("/api/"+n.namespace,o),n.version&&e.use("/api/v"+n.version+"/"+n.namespace,o)}})}},{key:"registerSockets",value:function(e,t){var n=this;l.forIn(this.services,function(r,o){if(!1!==r.ws){r.socket=r.socket||{};var i=void 0;i=r.socket.nsp&&"/"!==r.socket.nsp?t.addNameSpace(r.socket.nsp,r.role):e,r.io=i,i.on("connection",function(e){l.isFunction(r.socket.afterConnection)&&r.socket.afterConnection.call(r,e,i),l.forIn(r.actions,function(t,o){var i=t.settings;if(i.handler=t,!l.isFunction(i.handler))throw new Error("Missing handler function in '"+o+"' action in '"+r.name+"' service!");var a="/"+r.namespace+"/"+i.name,u=function(t,o){var a=f.CreateFromSocket(r,i,n.app,e,t);s.debug("Request via WebSocket '"+r.namespace+"/"+i.name+"'",a.params),console.time("SOCKET request"),n.emit("request",a);r.getCacheKey(i.name,a.params);Promise.resolve().then(function(){return a.resolveModel()}).then(function(){return a.checkPermission()}).then(function(){return i.handler(a)}).then(function(e){l.isFunction(o)&&o(v.json(null,e))}).catch(function(e){s.error(e),l.isFunction(o)&&o(v.json(null,null,e))}).then(function(){n.emit("response",a),console.timeEnd("SOCKET request")})};e.on(a,u),r.version&&e.on("/v"+r.version+a,u)})})}})}},{key:"registerGraphQLSchema",value:function(){var e=this,t={queries:[],types:[],mutations:[],resolvers:[]};if(l.forIn(this.services,function(n,r){if(!1!==n.$settings.graphql&&l.isObject(n.$schema.graphql)){var o=n.$schema.graphql;o.resolvers=o.resolvers||{};var i=function(t){l.forIn(t,function(r,o){if(l.isString(r)&&n.actions[r]){var i=function(t,i,a){var u=n.actions[r],c=u.settings;if(c.handler=u,!l.isFunction(c.handler))throw new Error("Missing handler function in '"+o+"' action in '"+n.name+"' service!");var d=f.CreateFromGraphQL(n,c,t,i,a);s.debug("Request via GraphQL",d.params,a.query),console.time("GRAPHQL request"),e.emit("request",d);n.getCacheKey(c.name,d.params);return Promise.resolve().then(function(){return d.resolveModel()}).then(function(){return d.checkPermission()}).then(function(){return c.handler(d)}).catch(function(e){throw s.error(e),e}).then(function(t){return e.emit("response",d),console.timeEnd("GRAPHQL request"),t})};t[o]=i}})};o.resolvers.Query&&i(o.resolvers.Query),o.resolvers.Mutation&&i(o.resolvers.Mutation),t.queries.push(o.query),t.types.push(o.types),t.mutations.push(o.mutation),t.resolvers.push(o.resolvers)}}),0==t.queries.length)return null;var n="\n\n\t\t\tscalar Timestamp\n\n\t\t\ttype Query {\n\t\t\t\t"+t.queries.join("\n")+"\n\t\t\t}\n\n\t\t\t"+t.types.join("\n")+"\n\n\t\t\ttype Mutation {\n\t\t\t\t"+t.mutations.join("\n")+"\n\t\t\t}\n\n\t\t\tschema {\n\t\t\t\tquery: Query\n\t\t\t\tmutation: Mutation\n\t\t\t}\n\t\t";return{schema:[n],resolvers:function(e){return t.resolvers.forEach(function(t){e=l.merge(e,t)}),e}({Timestamp:{__parseValue:function(e){return new Date(e)},__serialize:function(e){return e.getTime()},__parseLiteral:function(e){return e.kind===g.INT?parseInt(e.value,10):null}}})}}},{key:"get",value:function(e){return this.services[e]}},{key:"printServicesInfo",value:function(){h(this.app)}}]),u}(u);e.exports=new k}).call(t,"server/core")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(7),a=n(4);e.exports.isAuthenticated=function(e,t,n){return e.isAuthenticated()?n():t.sendStatus(401)},e.exports.tryAuthenticateWithApiKey=function(e,t,n){e.isAuthenticated()?n():e.headers.apikey||e.query.apikey||e.body.apikey?i.authenticate("localapikey",function(t,o,i){o?e.login(o,function(e){n()}):(r.warn("Apikey error:",i),n())})(e,t,n):n()},e.exports.isAuthenticatedOrApiKey=function(e,t,n){return e.isAuthenticated()?n():e.headers.apikey||e.query.apikey||e.body.apikey?void i.authenticate("localapikey",function(r,o,i){return r?t.sendStatus(500):o?void e.login(o,function(e){return e?t.sendStatus(500):n()}):t.status(401).send(i.message||"")})(e,t,n):t.sendStatus(401)},e.exports.hasRole=function(t){if(!t)throw new Error("Required role needs to be set");return function(n,r,o){return e.exports.isAuthenticated(n,r,function(){n.user&&n.user.roles&&-1!==n.user.roles.indexOf(t)?o():r.sendStatus(403)})}},e.exports.hasAdminRole=function(){return e.exports.hasRole("admin")},e.exports.linkToSocialAccount=function(e){var t=e.req,n=(e.accessToken,e.refreshToken,e.credentials),r=e.profile,i=e.done,s=e.provider,u=(e.username,e.email),c=e.userData;if(t.user){var l={};l["socialLinks."+s]=r.id,a.findOne(l,function(e,o){if(o){if(o._id!=t.user._id)return t.flash("error",{msg:t.t("SocialIDLinkedToOtherAccount")}),i(e);o.credentials=n,o.save(function(e){i(e,o)})}else a.findById(t.user.id,function(e,o){o.socialLinks=o.socialLinks||{},o.socialLinks[s]=r.id,o.profile=o.profile||{},o.profile.name=o.profile.name||c.name,o.profile.gender=o.profile.gender||c.gender,o.profile.picture=o.profile.picture||c.picture,o.profile.location=o.profile.location||c.location,o.credentials=n,o.save(function(e){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),i(e,o)})})})}else{var d={};d["socialLinks."+s]=r.id,a.findOne(d,function(e,l){if(l){if(1!==l.status)return t.flash("error",{msg:t.t("UserDisabledOrDeleted")}),i();l.credentials=n,l.save(function(e){i(e,l)})}else{if(!u)return t.flash("error",{msg:t.t("SocialMissingEmailAddress")}),i();a.findOne({email:u},function(e,l){if(l){if(1!==l.status)return t.flash("error",{msg:t.t("UserDisabledOrDeleted")}),i();var d=l;return d.socialLinks=d.socialLinks||{},d.socialLinks[s]=r.id,d.profile=d.profile||{},d.profile.name=d.profile.name||c.name,d.profile.gender=d.profile.gender||c.gender,d.profile.picture=d.profile.picture||c.picture,d.profile.location=d.profile.location||c.location,d.credentials=n,void d.save(function(e){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),i(e,d)})}if(!0===o.features.disableSignUp)return t.flash("error",{msg:t.t("SignUpDisabledPleaseLogin")}),i();var p=new a;p.fullName=c.name,p.email=u,p.username=u,p.provider=s,p.verified=!0,p.passwordLess=!0,p.socialLinks={},p.socialLinks[s]=r.id,p.profile=c,p.credentials=n,p.save(function(e){i(e,p)})})}})}}},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";e.exports={BAD_REQUEST:{status:400,type:"BAD_REQUEST",message:"Invalid request"},UNAUTHORIZED:{status:401,type:"UNAUTHORIZED",message:"Unauthorized. Please login first!"},REQUEST_FAILED:{status:402,type:"REQUEST_FAILED",message:"Request failed!"},FORBIDDEN:{status:403,type:"FORBIDDEN",message:"You have not enough permission for this resource!"},NOT_FOUND:{status:404,type:"NOT_FOUND",message:"Not found!"},TOO_MANY_REQUEST:{status:429,type:"TOO_MANY_REQUEST",message:"Too many request!"},SERVER_ERROR:{status:500,type:"SERVER_ERROR",message:"Server error"},NOT_IMPLEMENTED:{status:501,type:"NOT_IMPLEMENTED",message:"This resource is not implemented!"},json:function(e,t,n,r){var o={};return n?(o.error=n,o.status=n.status||500,r&&(o.error.message=r.message||r),o.data=t,e?e.status(o.status).json(o):o):(o.status=200,o.data=t,e?e.json(o):o)}}},function(e,t,n){"use strict";var r=n(1),o=n(0),i=(n(5),n(13),n(29)),a=n(2),s=n(30),u=n(7),c=n(110),l=n(31),d=n(32)(l),p=void 0,f={IO:null,mongoStore:null,namespaces:{},userSockets:[],init:function(e,t){f.mongoStore=new d({mongooseConnection:t.connection,collection:o.sessions.collection,autoReconnect:!0});var a=i.createServer(e),s=c(a);return e.io=f,f.IO=s,f.initNameSpace("/",s,f.mongoStore),s.on("connection",function(e){e.on("welcome",function(t){r.info("Incoming welcome message from "+e.request.user.username+":",t)})}),n(12).registerSockets(s,f),a},addNameSpace:function(e,t){var n=f.namespaces[e];return null==n&&(n=f.IO.of(e),f.initNameSpace(e,n,f.mongoStore,t)),n},initNameSpace:function(e,t,i,a){t.use(function(t,n){s(o.sessionSecret)(t.request,{},function(s){var c=t.request.signedCookies?t.request.signedCookies[o.sessions.name]:void 0;if(!c)return r.warn("sessionId was not found in socket.request"),n(new Error("sessionId was not found in socket.request"),!1);i.get(c,function(o,s){return o?n(o,!1):s?(t.request.session=s,s.socket=t.id,i.set(c,s),void u.initialize()(t.request,{},function(){u.session()(t.request,{},function(){if(t.request.user){var o=t.request.user;a?o.roles&&-1!==o.roles.indexOf(a)?n(null,!0):(r.warn("Websocket user has no access to this namespace '"+e+"'!",o.username),n(new Error("You have NO access to this namespace '"+e+"'!"),!1)):n(null,!0)}else r.warn("Websocket user is not authenticated!"),n(new Error("User is not authenticated! Please login first!"),!1)})})):n(new Error("session was not found for "+c),!1)})})}),t.on("connection",function(e){p||(p=n(12)),p.emit("socket:connect",e),f.addOnlineUser(e),r.debug("WS client connected to namespace "+(t.name||"root")+"! User: "+e.request.user.username),e.on("disconnect",function(){p.emit("socket:connect",e),f.removeSocket(e),r.debug("WS client disconnected from namespace "+(t.name||"root")+"!")})}),f.namespaces[e]=t},nsEmit:function(e,t,n){if(f.namespaces[e])return f.namespaces[e].emit(t,n),!0},addOnlineUser:function(e){f.removeOnlineUser(e),f.userSockets.push(e)},removeSocket:function(e){a.remove(f.userSockets,function(t){return t==e})},removeOnlineUser:function(e){a.remove(f.userSockets,function(t){return t.request.user._id==e.request.user._id})}};e.exports=f},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(10),a=n(70),s=void 0;o.redis.enabled&&(s=new a(o.redis.uri),s.on("connect",function(e){r.info(i.green.bold("Redis client connected!"))}),s.on("error",function(e){r.error(e)}),o.isDevMode()&&s.monitor(function(e,t){r.debug("Redis entering monitoring mode..."),t.on("monitor",function(e,t,n,o){r.debug("REDIS: ",t)})})),e.exports=s},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var r=n(54),o=new r(256,r.BASE62);e.exports=function(){return o.generate()}},function(e,t){e.exports={name:"Taschel",version:"0.9.0",title:"Taschel",description:"",main:"server/index.js",scripts:{build:"webpack --progress --colors --config build/webpack.prod.config.js","build:server":"webpack --progress --colors --config build/webpack.server.config.js",dev:"cross-env NODE_ENV=development nodemon --inspect","docker-dev":"cross-env NODE_ENV=development MONGO_URI=mongodb://mongo/ nodemon --inspect",start:"cross-env NODE_ENV=production node server/index.js","start:bundle":"cross-env NODE_ENV=production node server/bundle.js","start:cluster":"cross-env NODE_ENV=production node cluster.js","test:unit":"cross-env NODE_ENV=test mocha --require babel-core/register --reporter spec tests/unit","test:e2e:nightmare":"cross-env NODE_ENV=test mocha --require babel-core/register --timeout 30000 --reporter spec tests/e2e","test:e2e":"node tests/e2e/runner.js",test:"npm run test:unit && npm run test:e2e",ci:'cross-env NODE_ENV=test nodemon --exec "mocha --require babel-core/register --reporter dot --watch tests/unit" tests/unit',lint:"eslint --ext=.js,.vue client server","lint:fix":"eslint --fix --ext=.js,.vue client server","snyk-protect":"snyk protect",typings:"typings install",prepublish:"npm run snyk-protect"},repository:{type:"git",url:"git@github.com:uskithub/Taschel.git"},keywords:["taschel","express","mongo","vue","mongodb"],config:{dbName:"taschel"},author:"Yusuke SAITO",license:"MIT",dependencies:{agenda:"^1.0.3",async:"^2.6.0",axios:"^0.17.1","bcrypt-nodejs":"0.0.3","body-parser":"1.18.2",chalk:"^2.3.0","cli-table2":"0.2.0",clui:"^0.3.6",compression:"1.7.1","connect-mongo":"^2.0.1","cookie-parser":"1.4.3","cross-env":"^5.0.0",csurf:"1.9.0",dragula:"uskithub/dragula",express:"^4.16.2","express-flash":"0.0.2","express-list-endpoints":"^3.0.1","express-session":"1.15.6","express-status-monitor":"^1.0.1","express-validator":"^4.3.0",fakerator:"0.3.0",fecha:"^2.3.2",fullcalendar:"^3.8.0",glob:"7.1.2","google-auth-library":"^1.0.0",googleapis:"^25.0.0",graphql:"^0.12.3","graphql-server-express":"^1.3.2","graphql-subscriptions":"^0.5.6","graphql-tools":"^2.17.0",hashids:"^1.1.4",helmet:"^3.9.0","helmet-crossdomain":"0.1.0",i18next:"^10.2.2","i18next-express-middleware":"^1.0.9","i18next-node-fs-backend":"1.0.0","ion-rangeslider":"^2.2.0",ioredis:"^3.2.2",le_node:"^1.7.1",lodash:"4.17.4","method-override":"2.3.10",mkdirp:"0.5.1",moment:"^2.20.1",mongoose:"^4.13.9","mongoose-auto-increment":"5.0.1",morgan:"1.9.0",netjet:"^1.1.4","node-sass":"^4.7.2",nodemailer:"^4.4.1","nodemailer-html-to-text":"2.1.0","nodemailer-mailgun-transport":"^1.3.6","nodemailer-sendgrid-transport":"0.2.0","object-hash":"^1.2.0",passport:"^0.4.0","passport-facebook":"2.1.1","passport-github":"1.1.0","passport-google-oauth":"1.0.0","passport-local":"1.0.0","passport-localapikey-update":"^0.6.0","passport-twitter":"1.0.4","pretty-bytes":"4.0.2",pug:"2.0.0-beta6","require-webpack-compat":"3.0.0","serve-favicon":"2.4.5",slug:"0.9.1",snyk:"^1.41.1","socket.io":"^2.0.4","socket.io-client":"^2.0.4","uuid-token-generator":"1.0.0",winston:"^2.4.0","winston-daily-rotate-file":"^1.7.2","winston-graylog2":"^0.7.0","winston-loggly-bulk":"^2.0.2","winston-logsene":"^1.2.4","winston-logzio":"^1.0.6","winston-papertrail":"1.0.5"},devDependencies:{"apollo-cache-inmemory":"^1.1.5","apollo-client":"^2.2.0","apollo-link-http":"^1.3.2",autoprefixer:"^7.2.4",babel:"^6.23.0","babel-core":"^6.26.0","babel-loader":"^7.1.2","babel-preset-env":"^1.6.1","babel-preset-es2015":"6.24.1","babel-preset-stage-0":"6.24.1","babel-runtime":"^6.26.0",bootstrap:"^3.3.7","bootstrap-sass":"^3.3.7",chai:"^4.1.2",chromedriver:"^2.34.1","cross-spawn":"5.1.0","css-loader":"^0.28.8",del:"^3.0.0","eonasdan-bootstrap-datetimepicker":"^4.17.47","es6-promise":"^4.2.2",eslint:"^4.15.0","eslint-friendly-formatter":"3.0.0","eslint-loader":"^1.9.0","eslint-plugin-html":"^4.0.1","extract-text-webpack-plugin":"^3.0.2","file-loader":"^1.1.6","graphql-tag":"^2.6.1","i18next-browser-languagedetector":"^2.1.0","i18next-xhr-backend":"^1.5.1",jquery:"3.2.1","jquery-ui":"^1.12.1","json-loader":"^0.5.7",marked:"^0.3.12",mocha:"^4.1.0",nightwatch:"^0.9.19",nodemon:"^1.11.0","postcss-loader":"^2.0.10",precss:"^2.0.0","raw-loader":"0.5.1",request:"^2.83.0","sass-loader":"^6.0.6","selenium-server":"^3.8.1",sinon:"^4.1.4","sinon-chai":"^2.14.0","style-loader":"^0.19.1",toastr:"^2.1.4",typings:"2.1.1","url-loader":"^0.6.2",uuid:"^3.1.0",vue:"^2.5.13","vue-form-generator":"2.1.1","vue-html-loader":"1.2.4","vue-loader":"^13.7.0","vue-router":"^3.0.1","vue-template-compiler":"^2.5.13","vue-websocket":"0.2.2",vuex:"^3.0.1",webpack:"^3.10.0","webpack-dev-middleware":"^2.0.4","webpack-dev-server":"^2.10.1","webpack-hot-middleware":"^2.21.0","webpack-merge":"^4.1.1"},snyk:!0}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("webpack")},function(e,t,n){"use strict";function r(e,t){for(var n=/\r\n|[\n\r]/g,r=1,o=t+1,i=void 0;(i=n.exec(e.body))&&i.index<t;)r+=1,o=t+1-(i.index+i[0].length);return{line:r,column:o}}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocation=r},function(e,t,n){"use strict";function r(e,t,n,o,a,s,u){var c=Array.isArray(t)?0!==t.length?t:void 0:t?[t]:void 0,l=n;if(!l&&c){var d=c[0];l=d&&d.loc&&d.loc.source}var p=o;!p&&c&&(p=c.reduce(function(e,t){return t.loc&&e.push(t.loc.start),e},[])),p&&0===p.length&&(p=void 0);var f=void 0;if(o&&n){var m=n;f=o.map(function(e){return(0,i.getLocation)(m,e)})}else c&&(f=c.reduce(function(e,t){return t.loc&&e.push((0,i.getLocation)(t.loc.source,t.loc.start)),e},[]));Object.defineProperties(this,{message:{value:e,enumerable:!0,writable:!0},locations:{value:f||void 0,enumerable:!0},path:{value:a||void 0,enumerable:!0},nodes:{value:c||void 0},source:{value:l||void 0},positions:{value:p||void 0},originalError:{value:s},extensions:{value:u||s&&s.extensions}}),s&&s.stack?Object.defineProperty(this,"stack",{value:s.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,r):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.GraphQLError=r;var o=n(36),i=n(24);r.prototype=Object.create(Error.prototype,{constructor:{value:r},name:{value:"GraphQLError"},toString:{value:function(){return(0,o.printError)(this)}}})},function(e,t,n){"use strict";var r=(n(0),n(1),n(8),n(6)),o=r.Schema,i=n(11)("works"),a=n(9),s={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new o({title:{type:String,trim:!0},goal:{type:String,trim:!0},start:{type:Date},end:{type:Date},actualStart:{type:Date},actualEnd:{type:Date},description:{type:String,trim:!0},week:{type:String,trim:!0},parent:{type:Number,ref:"Task"},goodSide:{type:String,trim:!0},badSide:{type:String,trim:!0},improvement:{type:String,trim:!0},comments:[{type:Number,ref:"Comment"}],author:{type:Number,required:"Please fill in an author ID",ref:"User"},status:{type:Number,default:0},asignee:{type:Number,ref:"User"},metadata:{}},s);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(a.plugin,{model:"Work",startAt:1}),u.methods.encodeID=function(e){return e=e||this._id,i.encodeHex(e)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Work",u);e.exports=c},function(e,t,n){"use strict";var r=(n(0),n(1),n(8),n(6)),o=r.Schema,i=n(11)("tasks"),a=n(9),s={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new o({type:{type:String,trim:!0},name:{type:String,trim:!0},shortname:{type:String,trim:!0},purpose:{type:String,trim:!0},goal:{type:String,trim:!0},description:{type:String,trim:!0},deadline:{type:Date},timeframe:{type:Number,default:-1},root:{type:Number,ref:"Task"},parent:{type:Number,ref:"Task"},children:[{type:Number,ref:"Task"}],works:[{type:Number,ref:"Work"}],status:{type:Number,default:0},closingComment:{type:String,trim:!0},author:{type:Number,required:"Please fill in an author ID",ref:"User"},asignee:{type:Number,ref:"User"},isDeleted:{type:Number,default:0},lastCommunication:{type:Date,default:Date.now},metadata:{}},s);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(a.plugin,{model:"Task",startAt:1}),u.methods.encodeID=function(e){return e=e||this._id,i.encodeHex(e)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Task",u);e.exports=c},function(e,t){e.exports=require("mkdirp")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("connect-mongo")},function(e,t){e.exports=require("object-hash")},function(e,t,n){"use strict";function r(e,t){var n=new s(b,0,0,0,0,null);return{source:e,options:t,lastToken:n,token:n,line:1,lineStart:0,advance:o,lookahead:i}}function o(){return this.lastToken=this.token,this.token=this.lookahead()}function i(){var e=this.token;if(e.kind!==w)do{e=e.next||(e.next=c(this,e))}while(e.kind===V);return e}function a(e){var t=e.value;return t?e.kind+' "'+t+'"':e.kind}function s(e,t,n,r,o,i,a){this.kind=e,this.start=t,this.end=n,this.line=r,this.column=o,this.value=a,this.prev=i,this.next=null}function u(e){return isNaN(e)?w:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'+("00"+e.toString(16).toUpperCase()).slice(-4)+'"'}function c(e,t){var n=e.source,r=n.body,o=r.length,i=d(r,t.end,e),a=e.line,c=1+i-e.lineStart;if(i>=o)return new s(w,o,o,a,c,t);var m=G.call(r,i);if(m<32&&9!==m&&10!==m&&13!==m)throw(0,E.syntaxError)(n,i,"Cannot contain the invalid character "+u(m)+".");switch(m){case 33:return new s(T,i,i+1,a,c,t);case 35:return p(n,i,a,c,t);case 36:return new s(N,i,i+1,a,c,t);case 40:return new s(O,i,i+1,a,c,t);case 41:return new s(D,i,i+1,a,c,t);case 46:if(46===G.call(r,i+1)&&46===G.call(r,i+2))return new s(_,i,i+3,a,c,t);break;case 58:return new s(x,i,i+1,a,c,t);case 61:return new s(P,i,i+1,a,c,t);case 64:return new s(R,i,i+1,a,c,t);case 91:return new s(A,i,i+1,a,c,t);case 93:return new s(C,i,i+1,a,c,t);case 123:return new s(M,i,i+1,a,c,t);case 124:return new s(L,i,i+1,a,c,t);case 125:return new s(q,i,i+1,a,c,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return k(n,i,a,c,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return f(n,i,m,a,c,t);case 34:return 34===G.call(r,i+1)&&34===G.call(r,i+2)?h(n,i,a,c,t):v(n,i,a,c,t)}throw(0,E.syntaxError)(n,i,l(m))}function l(e){return 39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character "+u(e)+"."}function d(e,t,n){for(var r=e.length,o=t;o<r;){var i=G.call(e,o);if(9===i||32===i||44===i||65279===i)++o;else if(10===i)++o,++n.line,n.lineStart=o;else{if(13!==i)break;10===G.call(e,o+1)?o+=2:++o,++n.line,n.lineStart=o}}return o}function p(e,t,n,r,o){var i=e.body,a=void 0,u=t;do{a=G.call(i,++u)}while(null!==a&&(a>31||9===a));return new s(V,t,u,n,r,o,J.call(i,t+1,u))}function f(e,t,n,r,o,i){var a=e.body,c=n,l=t,d=!1;if(45===c&&(c=G.call(a,++l)),48===c){if((c=G.call(a,++l))>=48&&c<=57)throw(0,E.syntaxError)(e,l,"Invalid number, unexpected digit after 0: "+u(c)+".")}else l=m(e,l,c),c=G.call(a,l);return 46===c&&(d=!0,c=G.call(a,++l),l=m(e,l,c),c=G.call(a,l)),69!==c&&101!==c||(d=!0,c=G.call(a,++l),43!==c&&45!==c||(c=G.call(a,++l)),l=m(e,l,c)),new s(d?F:U,t,l,r,o,i,J.call(a,t,l))}function m(e,t,n){var r=e.body,o=t,i=n;if(i>=48&&i<=57){do{i=G.call(r,++o)}while(i>=48&&i<=57);return o}throw(0,E.syntaxError)(e,o,"Invalid number, expected digit but got: "+u(i)+".")}function v(e,t,n,r,o){for(var i=e.body,a=t+1,c=a,l=0,d="";a<i.length&&null!==(l=G.call(i,a))&&10!==l&&13!==l;){if(34===l)return d+=J.call(i,c,a),new s(B,t,a+1,n,r,o,d);if(l<32&&9!==l)throw(0,E.syntaxError)(e,a,"Invalid character within String: "+u(l)+".");if(++a,92===l){switch(d+=J.call(i,c,a-1),l=G.call(i,a)){case 34:d+='"';break;case 47:d+="/";break;case 92:d+="\\";break;case 98:d+="\b";break;case 102:d+="\f";break;case 110:d+="\n";break;case 114:d+="\r";break;case 116:d+="\t";break;case 117:var p=g(G.call(i,a+1),G.call(i,a+2),G.call(i,a+3),G.call(i,a+4));if(p<0)throw(0,E.syntaxError)(e,a,"Invalid character escape sequence: \\u"+i.slice(a+1,a+5)+".");d+=String.fromCharCode(p),a+=4;break;default:throw(0,E.syntaxError)(e,a,"Invalid character escape sequence: \\"+String.fromCharCode(l)+".")}++a,c=a}}throw(0,E.syntaxError)(e,a,"Unterminated string.")}function h(e,t,n,r,o){for(var i=e.body,a=t+3,c=a,l=0,d="";a<i.length&&null!==(l=G.call(i,a));){if(34===l&&34===G.call(i,a+1)&&34===G.call(i,a+2))return d+=J.call(i,c,a),new s(K,t,a+3,n,r,o,(0,I.default)(d));if(l<32&&9!==l&&10!==l&&13!==l)throw(0,E.syntaxError)(e,a,"Invalid character within String: "+u(l)+".");92===l&&34===G.call(i,a+1)&&34===G.call(i,a+2)&&34===G.call(i,a+3)?(d+=J.call(i,c,a)+'"""',a+=4,c=a):++a}throw(0,E.syntaxError)(e,a,"Unterminated string.")}function g(e,t,n,r){return y(e)<<12|y(t)<<8|y(n)<<4|y(r)}function y(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function k(e,t,n,r,o){for(var i=e.body,a=i.length,u=t+1,c=0;u!==a&&null!==(c=G.call(i,u))&&(95===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122);)++u;return new s(j,t,u,n,r,o,J.call(i,t,u))}Object.defineProperty(t,"__esModule",{value:!0}),t.TokenKind=void 0,t.createLexer=r,t.getTokenDesc=a;var E=n(35),S=n(118),I=function(e){return e&&e.__esModule?e:{default:e}}(S),b="<SOF>",w="<EOF>",T="!",N="$",O="(",D=")",_="...",x=":",P="=",R="@",A="[",C="]",M="{",L="|",q="}",j="Name",U="Int",F="Float",B="String",K="BlockString",V="Comment",G=(t.TokenKind={SOF:b,EOF:w,BANG:T,DOLLAR:N,PAREN_L:O,PAREN_R:D,SPREAD:_,COLON:x,EQUALS:P,AT:R,BRACKET_L:A,BRACKET_R:C,BRACE_L:M,PIPE:L,BRACE_R:q,NAME:j,INT:U,FLOAT:F,STRING:B,BLOCK_STRING:K,COMMENT:V},String.prototype.charCodeAt),J=String.prototype.slice;s.prototype.toJSON=s.prototype.inspect=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25);Object.defineProperty(t,"GraphQLError",{enumerable:!0,get:function(){return r.GraphQLError}});var o=n(115);Object.defineProperty(t,"syntaxError",{enumerable:!0,get:function(){return o.syntaxError}});var i=n(116);Object.defineProperty(t,"locatedError",{enumerable:!0,get:function(){return i.locatedError}});var a=n(36);Object.defineProperty(t,"printError",{enumerable:!0,get:function(){return a.printError}});var s=n(117);Object.defineProperty(t,"formatError",{enumerable:!0,get:function(){return s.formatError}})},function(e,t,n){"use strict";function r(e){var t=[];if(e.nodes)e.nodes.forEach(function(e){e.loc&&t.push(o(e.loc.source,(0,u.getLocation)(e.loc.source,e.loc.start)))});else if(e.source&&e.locations){var n=e.source;e.locations.forEach(function(e){t.push(o(n,e))})}return 0===t.length?e.message:[e.message].concat(t).join("\n\n")+"\n"}function o(e,t){var n=t.line,r=e.locationOffset.line-1,o=i(e,t),u=n+r,c=t.column+o,l=(u-1).toString(),d=u.toString(),p=(u+1).toString(),f=p.length,m=e.body.split(/\r\n|[\n\r]/g);return m[0]=a(e.locationOffset.column-1)+m[0],[e.name+" ("+u+":"+c+")",n>=2&&s(f,l)+": "+m[n-2],s(f,d)+": "+m[n-1],a(2+f+c-1)+"^",n<m.length&&s(f,p)+": "+m[n]].filter(Boolean).join("\n")}function i(e,t){return 1===t.line?e.locationOffset.column-1:0}function a(e){return Array(e+1).join(" ")}function s(e,t){return a(e-t.length)+t}Object.defineProperty(t,"__esModule",{value:!0}),t.printError=r;var u=n(24)},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Source=void 0;var o=n(37),i=function(e){return e&&e.__esModule?e:{default:e}}(o);t.Source=function e(t,n,o){r(this,e),this.body=t,this.name=n||"GraphQL request",this.locationOffset=o||{line:1,column:1},this.locationOffset.line>0||(0,i.default)(0,"line in locationOffset is 1-indexed and must be positive"),this.locationOffset.column>0||(0,i.default)(0,"column in locationOffset is 1-indexed and must be positive")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NAME="Name",t.DOCUMENT="Document",t.OPERATION_DEFINITION="OperationDefinition",t.VARIABLE_DEFINITION="VariableDefinition",t.VARIABLE="Variable",t.SELECTION_SET="SelectionSet",t.FIELD="Field",t.ARGUMENT="Argument",t.FRAGMENT_SPREAD="FragmentSpread",t.INLINE_FRAGMENT="InlineFragment",t.FRAGMENT_DEFINITION="FragmentDefinition",t.INT="IntValue",t.FLOAT="FloatValue",t.STRING="StringValue",t.BOOLEAN="BooleanValue",t.NULL="NullValue",t.ENUM="EnumValue",t.LIST="ListValue",t.OBJECT="ObjectValue",t.OBJECT_FIELD="ObjectField",t.DIRECTIVE="Directive",t.NAMED_TYPE="NamedType",t.LIST_TYPE="ListType",t.NON_NULL_TYPE="NonNullType",t.SCHEMA_DEFINITION="SchemaDefinition",t.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",t.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",t.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",t.FIELD_DEFINITION="FieldDefinition",t.INPUT_VALUE_DEFINITION="InputValueDefinition",t.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",t.UNION_TYPE_DEFINITION="UnionTypeDefinition",t.ENUM_TYPE_DEFINITION="EnumTypeDefinition",t.ENUM_VALUE_DEFINITION="EnumValueDefinition",t.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",t.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",t.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",t.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",t.UNION_TYPE_EXTENSION="UnionTypeExtension",t.ENUM_TYPE_EXTENSION="EnumTypeExtension",t.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension",t.DIRECTIVE_DEFINITION="DirectiveDefinition"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DirectiveLocation={QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"}},function(e,t,n){"use strict";function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u,r=void 0,i=Array.isArray(e),a=[e],l=-1,d=[],p=void 0,f=void 0,m=void 0,v=[],h=[],g=e;do{l++;var y=l===a.length,k=y&&0!==d.length;if(y){if(f=0===h.length?void 0:v[v.length-1],p=m,m=h.pop(),k){if(i)p=p.slice();else{var E={};for(var S in p)p.hasOwnProperty(S)&&(E[S]=p[S]);p=E}for(var I=0,b=0;b<d.length;b++){var w=d[b][0],T=d[b][1];i&&(w-=I),i&&null===T?(p.splice(w,1),I++):p[w]=T}}l=r.index,a=r.keys,d=r.edits,i=r.inArray,r=r.prev}else{if(f=m?i?l:a[l]:void 0,null===(p=m?m[f]:g)||void 0===p)continue;m&&v.push(f)}var N=void 0;if(!Array.isArray(p)){if(!o(p))throw new Error("Invalid AST Node: "+JSON.stringify(p));var O=s(t,p.kind,y);if(O){if((N=O.call(t,p,f,m,v,h))===c)break;if(!1===N){if(!y){v.pop();continue}}else if(void 0!==N&&(d.push([f,N]),!y)){if(!o(N)){v.pop();continue}p=N}}}void 0===N&&k&&d.push([f,p]),y?v.pop():(r={inArray:i,index:l,keys:a,edits:d,prev:r},i=Array.isArray(p),a=i?p:n[p.kind]||[],l=-1,d=[],m&&h.push(m),m=p)}while(void 0!==r);return 0!==d.length&&(g=d[d.length-1][1]),g}function o(e){return Boolean(e&&"string"==typeof e.kind)}function i(e){var t=new Array(e.length);return{enter:function(n){for(var r=0;r<e.length;r++)if(!t[r]){var o=s(e[r],n.kind,!1);if(o){var i=o.apply(e[r],arguments);if(!1===i)t[r]=n;else if(i===c)t[r]=c;else if(void 0!==i)return i}}},leave:function(n){for(var r=0;r<e.length;r++)if(t[r])t[r]===n&&(t[r]=null);else{var o=s(e[r],n.kind,!0);if(o){var i=o.apply(e[r],arguments);if(i===c)t[r]=c;else if(void 0!==i&&!1!==i)return i}}}}}function a(e,t){return{enter:function(n){e.enter(n);var r=s(t,n.kind,!1);if(r){var i=r.apply(t,arguments);return void 0!==i&&(e.leave(n),o(i)&&e.enter(i)),i}},leave:function(n){var r=s(t,n.kind,!0),o=void 0;return r&&(o=r.apply(t,arguments)),e.leave(n),o}}}function s(e,t,n){var r=e[t];if(r){if(!n&&"function"==typeof r)return r;var o=n?r.leave:r.enter;if("function"==typeof o)return o}else{var i=n?e.leave:e.enter;if(i){if("function"==typeof i)return i;var a=i[t];if("function"==typeof a)return a}}}Object.defineProperty(t,"__esModule",{value:!0}),t.visit=r,t.visitInParallel=i,t.visitWithTypeInfo=a,t.getVisitFn=s;var u=t.QueryDocumentKeys={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"]},c=t.BREAK={}},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("nodemailer-html-to-text")},function(e,t){e.exports=require("nodemailer-mailgun-transport")},function(e,t){e.exports=require("nodemailer-sendgrid-transport")},function(e,t,n){"use strict";var r=(n(0),n(1),n(8),n(6)),o=r.Schema,i=n(11)("reviews"),a=n(9),s={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new o({week:{type:String,trim:!0},date:{type:String,trim:!0},works:[{type:Number,ref:"Work"}],highOrderAwakening:{type:String,trim:!0},comments:[{type:Number,ref:"Comment"}],author:{type:Number,required:"Please fill in an author ID",ref:"User"},metadata:{}},s);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(a.plugin,{model:"Review",startAt:1}),u.methods.encodeID=function(e){return e=e||this._id,i.encodeHex(e)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Review",u);e.exports=c},function(e,t,n){"use strict";var r=(n(0),n(1),n(8),n(6)),o=r.Schema,i=n(11)("groups"),a=n(9),s={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new o({type:{type:String,trim:!0},name:{type:String,trim:!0},purpose:{type:String,trim:!0},parent:{type:Number,ref:"Task"},children:[{type:Number,ref:"Task"}],author:{type:Number,required:"Please fill in an author ID",ref:"User"},lastCommunication:{type:Date,default:Date.now},metadata:{}},s);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(a.plugin,{model:"Group",startAt:1}),u.methods.encodeID=function(e){return e=e||this._id,i.encodeHex(e)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Group",u);e.exports=c},function(e,t,n){"use strict";e.exports=n(4)},function(e,t){e.exports=require("async")},function(e,t,n){"use strict";var r=n(0),o=n(1),i=n(42),a=n(43).htmlToText;e.exports={send:function(e,t,s,u){o.info("Sending email to "+e+" with subject "+t+"..."),o.debug("Deprecated! libs/mailer is deprecated. Use Service.get('mailer') instead!");var c={};e instanceof Object?e instanceof Array?c.to=e:c=e:c.to=e;var l={from:r.mailer.from,to:c.to,cc:c.cc,bcc:c.bcc,subject:t,html:s},d=void 0;if("smtp"==r.mailer.transport)d=i.createTransport(r.mailer.smtp);else if("mailgun"==r.mailer.transport){var p=n(44);d=i.createTransport(p({auth:{api_key:r.mailer.mailgun.apiKey,domain:r.mailer.mailgun.domain}}))}else if("sendgrid"==r.mailer.transport){var f=n(45);d=i.createTransport(f({auth:{api_key:r.mailer.sendgrid.apiKey}}))}d?(d.use("compile",a()),d.sendMail(l,function(e,t){e?o.warn("Unable to send email: ",e):o.info("Email message sent.",t.response),u&&u(e,t)})):o.warn("Unable to send email! Invalid mailer transport: "+r.mailer.transport)}}},function(e,t){e.exports=require("graphql-server-express")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(15),a=n(10),s=n(154),u=n(4),c=new s({db:{address:o.db.uri,collection:"agendaJobs"},processEvery:o.agendaTimer||"one minute"});c.on("fail",function(e,t){return r.error("Job failed with error: "+e.message)}),c.define("removeUnverifiedAccounts",function(e,t){r.debug("Running 'removeUnverifiedAccounts' process...");try{u.remove({createdAt:{$lte:i().subtract(1,"day").toDate()},verified:!1},function(e,n){n>0&&r.warn(a.bold.red(n+" unverified and expired account removed!")),t()})}catch(e){return r.error("Job running exception!"),r.error(e),t(e)}}),c.on("ready",function(){o.isTestMode()||(c.every("8 hours","removeUnverifiedAccounts"),c.start(),r.info(a.yellow("Agenda started!")))}),e.exports=c},function(e,t,n){"use strict";global.WEBPACK_BUNDLE=!1;var r=n(0),o=n(1),i=n(15),a=n(10);o.info(),o.info(a.bold("---------------------[ Server starting at %s ]---------------------------"),i().format("YYYY-MM-DD HH:mm:ss.SSS")),o.info(),o.info(a.bold("Application root path: ")+global.rootPath);var s=(n(68),n(8)()),u=n(69)(s);n(52);n(155),u.listen(r.port,r.ip,function(){o.info(""),o.info(r.app.title+" v"+r.app.version+" application started!"),o.info("----------------------------------------------"),o.info("Environment:\t"+a.underline.bold(process.env.NODE_ENV)),o.info("IP:\t\t"+r.ip),o.info("Port:\t\t"+r.port),o.info("Database:\t\t"+r.db.uri),o.info("Redis:\t\t"+(r.redis.enabled?r.redis.uri:"Disabled")),o.info(""),n(156)(),o.info("----------------------------------------------");var e=n(12);r.isDevMode&&e.printServicesInfo()}),e.exports=u},function(e,t){e.exports=require("uuid-token-generator")},function(e,t){e.exports='"use strict";\n\nvar path = require("path");\nvar pkg = require("./package.json");\n\nmodule.exports = {\n\thashSecret: "{{hashSecret}}",\n\n\tsessionSecret: "{{sessionSecret}}",\n\n\tapp: {},\n\n\tdb: {\n\t\toptions: {\n\t\t\tuser: process.env.MONGO_USERNAME || "",\n\t\t\tpass: process.env.MONGO_PASSWORD || ""\n\t\t}\n\t},\n\n\tredis: {\n\t\tenabled: false,\n\t\turi: process.env.REDIS_URI || "redis://localhost:6379",\n\t\toptions: null\n\t},\n\n\tmailer: {},\n\n\tfeatures: {\n\t\tdisableSignUp: false,\n\t\tverificationRequired: true\n\t},\n\n\tauthKeys: {\n\n\t\tgoogle: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\tfacebook: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\tgithub: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\ttwitter: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t}\n\t},\n\n\tlogging: {\n\n\t\tconsole: {},\n\n\t\tfile: {\n\t\t\tenabled: false\n\t\t},\n\n\t\tgraylog: {\n\t\t\tenabled: false\n\t\t},\n\n\t\tpapertrail: {\n\t\t\tenabled: false,\n\t\t\thost: null,\n\t\t\tport: null,\n\t\t\tlevel: "debug",\n\t\t\tprogram: "vem"\n\t\t},\n\n\t\tlogentries: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t},\n\n\t\tloggly: {\n\t\t\tenabled: false,\n\t\t\ttoken: null,\n\t\t\tsubdomain: null\n\t\t},\n\n\t\tlogsene: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t},\n\n\t\tlogzio: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t}\n\n\t}\n\n};'},function(e,t){e.exports=require("../config.js")},function(e,t,n){"use strict";var r=n(5),o=n(21);e.exports={app:{title:o.title,version:o.version,description:o.description,keywords:o.keywords.join(","),url:"http://localhost:"+(process.env.PORT||3e3)+"/",contactEmail:"hello@vem-app.com"},ip:process.env.NODE_IP||"0.0.0.0",port:process.env.PORT||3e3,rootPath:global.rootPath,dataFolder:r.join(global.rootPath,"data"),uploadLimit:2097152,sessions:{cookie:{maxAge:6048e5,httpOnly:!0,secure:!1},name:"sessionId",collection:"sessions"},test:!1,db:{useMongoClient:!0,uri:process.env.MONGO_URI||"mongodb://ec2-13-230-216-246.ap-northeast-1.compute.amazonaws.com:27017/taschel",options:{user:"",pass:"",server:{socketOptions:{keepAlive:1}}}},redis:{enabled:!1,uri:process.env.REDIS_URI||"redis://localhost:6379",options:null},cacheTimeout:null,mailer:{enabled:!1,from:"noreply@vem-app.com"},features:{disableSignUp:!1,verificationRequired:!0},authKeys:{google:{clientID:null,clientSecret:null},facebook:{clientID:null,clientSecret:null},github:{clientID:null,clientSecret:null},twitter:{clientID:null,clientSecret:null}},logging:{console:{level:"debug"},file:{enabled:!1,path:r.join(global.rootPath,"logs"),level:"info",json:!1,exceptionFile:!0},graylog:{enabled:!1},papertrail:{enabled:!1,host:null,port:null,level:"debug",program:"vem"},logentries:{enabled:!1,token:null},loggly:{enabled:!1,token:null,subdomain:null},logsene:{enabled:!1,token:null},logzio:{enabled:!1,token:null}},agendaTimer:"one minute"}},function(e,t,n){"use strict";var r=n(21);e.exports={app:{title:r.name+" [Test mode]"},hashSecret:"71IIYMzMb0egTaCvvdijhUajAOjsrurzyRX5ziskMk4",sessionSecret:"MB9x-hOkx-UdcCbOprxggu-Wv1PetuoqzBny1h8DULA",mailer:{from:"noreply@jibunstyle.com",transport:"smtp",smtp:{host:"smtp.gmail.com",port:465,auth:{user:"noreply@jibunstyle.com",pass:""}}},test:!0,db:{uri:"mongodb://localhost/"+r.config.dbName+"-test",options:{user:"",pass:""}}}},function(e,t,n){"use strict";var r=n(21);e.exports={app:{},db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+r.config.dbName,options:{user:process.env.MONGO_USERNAME||"",pass:process.env.MONGO_PASSWORD||""}}}},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("le_node")},function(e,t){e.exports=require("winston-papertrail")},function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t){e.exports=require("winston-loggly-bulk")},function(e,t){e.exports=require("winston-logsene")},function(e,t){e.exports=require("winston-logzio")},function(e,t){e.exports=require("winston-graylog2")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(13),a=n(28);i.existsSync(o.dataFolder)||a.sync(o.dataFolder),o.isProductionMode()||(r.info("Loaded configuration:"),r.info(o),r.info())},function(e,t,n){"use strict";function r(e){e.locals.app=p.app,e.use(function(e,t,n){return t.locals.url=e.protocol+"://"+e.headers.host+e.url,n()}),e.locals.year=v().format("YYYY"),e.locals.features=p.features}function o(e){if(e.use(w({filter:function(e,t){return/json|text|javascript|css/.test(t.getHeader("Content-Type"))},level:3,threshold:512})),e.set("port",p.port),e.use(k.urlencoded({extended:!0,limit:2*p.contentMaxLength})),e.use(S()),e.use(k.json()),e.use(T()),p.isProductionMode()&&(e.use(I({cache:{max:100}})),e.use(f.static(m.join(R,"public")))),e.use(g(m.join(R,"public","favicon.ico"))),e.use(E()),e.set("etag",!0),e.use(h()),p.isDevMode()){var t=n(85),r=new t.Stream;r.writable=!0,r.write=function(e){return d.debug(e)},e.use(y("dev",{stream:r}))}}function i(e){var t={fallbackLng:"en",whitelist:["en","ja","hu"],ns:["app","frontend"],defaultNS:"frontend",load:"all",saveMissing:!0,saveMissingTo:"all",backend:{loadPath:m.join(R,"locales","{{lng}}","{{ns}}.json"),addPath:m.join(R,"locales","{{lng}}","{{ns}}.missing.json"),jsonIndent:4}};p.isTestMode()&&(t.whitelist=["ja"]),_.use(P).use(x.LanguageDetector).init(t,function(t,n){e.t=n,t&&d.warn(t)}),_.on("failedLoading",function(e,t,n){console.log("failedLoading",e,t,n)}),e.use(x.handle(_)),e.get("/locales/resources.json",x.getResourcesHandler(_)),e.post("/locales/add/:lng/:ns",x.missingKeyHandler(_))}function a(e){e.set("views",m.join(R,"views")),e.set("view engine","pug"),p.isDevMode()?(e.set("showStackError",!0),e.set("view cache",!1),e.use(N.noCache()),e.locals.pretty=!0):(e.locals.cache="memory",e.set("view cache",!0))}function s(e,t){e.use(b({saveUninitialized:!0,resave:!1,secret:p.sessionSecret,store:new D({mongooseConnection:t.connection,collection:p.sessions.collection,autoReconnect:!0}),cookie:p.sessions.cookie,name:p.sessions.name}))}function u(e){e.use(N.xssFilter()),e.use(N.noSniff()),e.use(N.frameguard()),e.use(N.ieNoOpen()),e.use(O()),e.use(N.hidePoweredBy())}function c(e){n(86)(e),p.isTestMode()}function l(e){if(!p.isProductionMode()){var t=n(23),r=n(102),o=t(r),i=n(105);e.use(i(o,{noInfo:!0,publicPath:r.output.publicPath,headers:{"Access-Control-Allow-Origin":"*"},stats:{colors:!0}}));var a=n(106);e.use(a(o,{log:d.info}))}}var d=n(1),p=n(0),f=(n(18),n(19)),m=(n(29),n(5)),v=n(15),h=n(71),g=n(72),y=n(73),k=n(74),E=n(30),S=n(75),I=(n(76),n(77)),b=n(31),w=n(78),T=n(79),N=n(80),O=n(81),D=(n(6),n(32)(b)),_=n(82),x=n(83),P=n(84),R=m.normalize(m.join(p.rootPath,"server"));e.exports=function(e){var t=f();r(t),o(t),a(t),u(t),i(t),s(t,e),c(t),l(t),n(12).loadServices(t,e);var d=n(17).init(t,e);return d._app=t,n(147)(t,e),d}},function(e,t){e.exports=require("ioredis")},function(e,t){e.exports=require("express-flash")},function(e,t){e.exports=require("serve-favicon")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-validator")},function(e,t){e.exports=require("csurf")},function(e,t){e.exports=require("netjet")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("helmet-crossdomain")},function(e,t){e.exports=require("i18next")},function(e,t){e.exports=require("i18next-express-middleware")},function(e,t){e.exports=require("i18next-node-fs-backend")},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";var r=n(1),o=(n(0),n(7)),i=n(5),a=n(10),s=n(4);e.exports=function(e){e.use(o.initialize()),e.use(o.session()),o.serializeUser(function(e,t){return t(null,e.id)}),o.deserializeUser(function(e,t){s.findOne({_id:e},"-password",function(e,n){return e?t(e):1!==n.status?t(null,!1):t(null,n)})}),r.info(""),r.info(a.bold("Search passport strategies..."));!function(e){e.keys().map(function(t){r.info("  Loading passport strategy file "+i.basename(t)+"...");var n=e(t);return n(),n})}(n(89))}},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("hashids")},function(e,t,n){function r(e){return n(o(e))}function o(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./apikey.js":90,"./facebook.js":92,"./github.js":94,"./google.js":96,"./local.js":98,"./twitter.js":100};r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id=89},function(e,t,n){"use strict";var r=n(7),o=n(91).Strategy,i=n(4);e.exports=function(){r.use(new o({passReqToCallback:!0},function(e,t,n){return i.findOne({apiKey:t},function(t,r){return t?n(t):r?r.verified?1!==r.status?n(null,!1,{message:e.t("UserDisabledOrDeleted")}):n(null,r):n(null,!1,{message:e.t("PleaseActivateAccount")}):n(null,!1,{message:e.t("UnknowAPIKey")})})}))}},function(e,t){e.exports=require("passport-localapikey-update")},function(e,t,n){"use strict";var r=(n(1),n(0)),o=n(14),i=n(7),a=n(93).Strategy;n(4);e.exports=function(){r.authKeys.facebook.clientID&&r.authKeys.facebook.clientSecret&&i.use("facebook",new a({clientID:r.authKeys.facebook.clientID,clientSecret:r.authKeys.facebook.clientSecret,callbackURL:"/auth/facebook/callback",profileFields:["name","email","link","locale","timezone"],passReqToCallback:!0},function(e,t,n,r,i){o.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:i,provider:"facebook",email:r._json.email,userData:{name:r.name.givenName+" "+r.name.familyName,gender:r._json.gender,picture:"https://graph.facebook.com/"+r.id+"/picture?type=large",location:r._json.location?r._json.location.name:null}})}))}},function(e,t){e.exports=require("passport-facebook")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(14),a=n(7),s=n(95).Strategy;n(4);e.exports=function(){o.authKeys.github.clientID&&o.authKeys.github.clientSecret&&a.use("github",new s({clientID:o.authKeys.github.clientID,clientSecret:o.authKeys.github.clientSecret,callbackURL:"/auth/github/callback",scope:["user:email"],passReqToCallback:!0},function(e,t,n,o,a){r.info("Received profile: ",o);var s=void 0;o.emails&&o.emails.length>0&&((s=o.emails.find(function(e){return e.primary}))||(s=o.emails[0])),i.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:o,done:a,provider:"github",username:o.username,email:s?s.value:null,userData:{name:o.displayName,gender:null,picture:o._json.avatar_url,location:o._json.location}})}))}},function(e,t){e.exports=require("passport-github")},function(e,t,n){"use strict";var r=(n(1),n(0)),o=n(14),i=n(7),a=n(97).OAuth2Strategy;n(4);e.exports=function(){r.authKeys.google.clientID&&r.authKeys.google.clientSecret&&i.use("google",new a({clientID:r.authKeys.google.clientID,clientSecret:r.authKeys.google.clientSecret,callbackURL:"/auth/google/callback",passReqToCallback:!0},function(e,t,n,r,i,a){n&&(r.refresh_token=n),o.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,credentials:r,profile:i,done:a,provider:"google",email:i.emails[0].value,userData:{name:i.displayName,gender:i.gender,picture:i.photos&&i.photos.length>0?i.photos[0].value.replace("sz=50","sz=200"):null,location:null}})}))}},function(e,t){e.exports=require("passport-google-oauth")},function(e,t,n){"use strict";var r=n(7),o=n(99).Strategy,i=n(4);e.exports=function(){r.use(new o({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(e,t,n,r){return i.findOne({$or:[{username:t},{email:t}]},function(t,o){return t?r(t):o?o.verified?1!==o.status?r(null,!1,{message:e.t("UserDisabledOrDeleted")}):o.passwordLess?r(null,!1,{message:e.t("PasswordlessAccountLeaveEmpty")}):void o.comparePassword(n,function(t,n){return t?r(t):!0!==n?r(null,!1,{message:e.t("InvalidPassword")}):r(null,o)}):r(null,!1,{message:e.t("PleaseActivateAccount")}):r(null,!1,{message:e.t("UnknowUsernameOrEmail")})})}))}},function(e,t){e.exports=require("passport-local")},function(e,t,n){"use strict";var r=(n(1),n(0)),o=n(14),i=n(7),a=n(101).Strategy;n(4);e.exports=function(){r.authKeys.twitter.clientID&&r.authKeys.twitter.clientSecret&&i.use("twitter",new a({consumerKey:r.authKeys.twitter.clientID,consumerSecret:r.authKeys.twitter.clientSecret,callbackURL:"/auth/twitter/callback",passReqToCallback:!0},function(e,t,n,r,i){o.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:i,provider:"twitter",email:r.username+"@twitter.com",username:r.username,userData:{name:r.displayName,gender:null,picture:r._json.profile_image_url_https,location:r._json.location}})}))}},function(e,t){e.exports=require("passport-twitter")},function(e,t,n){"use strict";var r=(n(5),n(23)),o=n(103),i=n(104);i.entry.app.unshift("webpack-hot-middleware/client"),i.entry.frontend.unshift("webpack-hot-middleware/client"),e.exports=o(i,{devtool:"#inline-source-map",module:{rules:[{test:/\.scss$/,loaders:["style-loader","css-loader","postcss-loader","sass-loader"]},{test:/\.vue$/,loader:"vue-loader"}]},performance:{hints:!1},plugins:[new r.HotModuleReplacementPlugin,new r.NoEmitOnErrorsPlugin]})},function(e,t){e.exports=require("webpack-merge")},function(e,t,n){"use strict";(function(t){var r=n(5),o=n(23);e.exports={devtool:"#inline-source-map",entry:{app:["./client/app/main.js"],vendor:["es6-promise","vue","vue-router","vuex","lodash","moment","jquery","jquery-ui","bootstrap","eonasdan-bootstrap-datetimepicker","axios","toastr","vue-form-generator","vue-websocket","apollo-client","apollo-cache-inmemory","apollo-link-http","graphql-tag","i18next"],frontend:["./client/frontend/main.js"]},output:{path:r.resolve(t,"..","server","public","app"),publicPath:"/app/",filename:"[name].js",chunkFilename:"[chunkhash].js"},module:{noParse:/es6-promise\.js$/,rules:[{test:/\.css$/,loaders:["style-loader","css-loader"]},{test:/\.js$/,loader:"babel-loader",exclude:[/node_modules/,/vendor/]},{test:/\.gif$/,loader:"url-loader",options:{name:"images/[name]-[hash:6].[ext]",limit:1e4}},{test:/\.png$/,loader:"url-loader",options:{name:"images/[name]-[hash:6].[ext]",limit:1e4}},{test:/\.jpg$/,loader:"file-loader",options:{name:"images/[name]-[hash:6].[ext]"}},{test:/\.(woff2?|svg)$/,loader:"url-loader",options:{limit:1e4,prefix:"font/"}},{test:/\.(ttf|eot)$/,loader:"file-loader",options:{prefix:"font/"}}]},resolve:{extensions:[".vue",".js",".json"],mainFiles:["index"],alias:{images:r.resolve(t,"..","client","images"),vue$:"vue/dist/vue.common.js"}},performance:{hints:!1},plugins:[new o.ProvidePlugin({$:"jquery",jQuery:"jquery","window.$":"jquery"})]}}).call(t,"build")},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t){e.exports=require("webpack-hot-middleware")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),a=(n(0),n(16)),s=n(20),u=n(3),c=n(17),l=n(2),d=(n(33),void 0),p=function(){function e(t){r(this,e),this.id=s(),this.createdAt=Date.now(),this.service=t,this.io=t.io,this.app=null,this.req=null,this.res=null,this.action=null,this.t=null,this.user=null,this.socket=null,this.params=[],this.model=null,this.modelID=null,this.provider="internal",this.validationErrors=[],d||(d=n(12))}return o(e,[{key:"services",value:function(e){return d.get(e)}},{key:"copy",value:function(t,n){var r=l.defaults(new e(this.service),this);return r.provider="internal",r.params=!0===n?l.defaults(this.params,t):t,r}},{key:"responseTime",value:function(){return Date.now()-this.createdAt}},{key:"resolveModel",value:function(){var e=this;if(l.isFunction(this.service.modelResolver)){var t=this.service.$settings.idParamName||"id",n=this.params[t];if(null!=n)return this.service.modelResolver.call(this.service,this,n).then(function(t){return e.model=t,t})}return Promise.resolve(null)}},{key:"assertModelIsExist",value:function(e){if(!this.model)throw this.errorBadRequest(u.ERR_MODEL_NOT_FOUND,e);return!0}},{key:"checkPermission",value:function(){var e=this,t=this.action.permission||this.service.$settings.permission||u.PERM_LOGGEDIN;return t==u.PERM_PUBLIC?Promise.resolve():Promise.resolve().then(function(){e.user||e.errorUnauthorized()}).then(function(){t!=u.PERM_ADMIN||e.isAdmin()?t==u.PERM_USER&&-1==e.user.roles.indexOf(u.ROLE_USER)&&e.errorForbidden():e.errorForbidden()}).then(function(){if(t==u.PERM_OWNER&&l.isFunction(e.service.$schema.ownerChecker))return e.service.$schema.ownerChecker(e).catch(function(t){if(l.isObject(t))throw t;e.errorForbidden(u.ERR_ONLY_OWNER_CAN_EDIT_AND_DELETE,e.t("app:YouAreNotTheOwner"))})})}},{key:"broadcast",value:function(e,t){if(this.io){var n="/"+this.service.namespace+"/"+e;i.debug("Send WS broadcast message to '"+n+"':",t),this.io.emit(n,t)}}},{key:"emitUser",value:function(e,t){var n=this;if(!this.socket&&this.user&&(this.socket=l.find(c.userSockets,function(e){return e.request.user._id==n.user._id})),this.socket){var r="/"+this.service.namespace+"/"+e;i.debug("Send WS message to "+this.socket.request.user.username+" '"+r+"':",t),this.socket.emit(r,t)}}},{key:"emit",value:function(e,t,n){var r=this;if(n||(n=this.service.$settings.role),!n){var o="/"+this.service.namespace+"/"+e;return i.debug("Send WS broadcast message to '"+o+"':",t),void(this.socket?this.socket.broadcast.emit(o,t):this.io.emit(o,t))}if(this.io){var a="/"+this.service.namespace+"/"+e;i.debug("Send WS message to '"+n+"' role '"+a),l.each(c.userSockets,function(e){var o=e.request.user;if(o&&o.roles&&-1!==o.roles.indexOf(n)){if("socket"==r.provider&&o==r.user)return;i.debug("Send WS message to "+o.username+" '"+a+"':",t),e.emit(a,t)}})}}},{key:"hasParam",value:function(e,t){return null!=this.params[e]}},{key:"validateParam",value:function(e,t){var n=this,r={name:e,value:null,errors:[]};r.noError=function(){return 0==r.errors.length},r.addError=function(e){r.errors.push(e),n.validationErrors.push(e)},r.end=function(){return r.noError()&&(n.params[r.name]=r.value),r.value},r.throw=function(){if(!r.noError())throw new Error(r.errors.join(" "));return r.value},r.notEmpty=function(t){return null!=r.value&&""!==r.value||r.addError(t||"Parameter '"+e+"' is empty!"),l.isArray(r.value)&&0==r.value.length&&r.addError(t||"Parameter '"+e+"' is empty!"),r},r.isNumber=function(e){return null==r.value||l.isNumber(r.value)},r.trim=function(){return r.noError()&&null!=r.value&&(r.value=r.value.trim()),r};var o=this.params[e];return null!=o&&(r.value=o),r}},{key:"hasValidationErrors",value:function(){return this.validationErrors.length>0}},{key:"errorBadRequest",value:function(e,t){var n=new Error(t);throw n=l.defaults(a.BAD_REQUEST),e&&(n.type=e),t&&(n.message=t),n}},{key:"errorForbidden",value:function(e,t){var n=new Error(t);throw n=l.defaults(a.FORBIDDEN),e&&(n.type=e),t&&(n.message=t),n}},{key:"errorUnauthorized",value:function(e,t){var n=new Error(t);throw n=l.defaults(a.UNAUTHORIZED),e&&(n.type=e),t&&(n.message=t),n}},{key:"notifyChanges",value:function(e,t,n){var r={status:200,event:e,data:t};if(this.user){var o=this.services("persons");r.user=o.toJSON(this.user)}this.emit(e,r,n)}},{key:"queryPageSort",value:function(e){return this.params&&(this.params.limit&&e.limit(this.params.limit),this.params.offset&&e.skip(this.params.offset),this.params.sort&&e.sort(this.params.sort.replace(/,/," "))),e}},{key:"isAuthenticated",value:function(e){return null!=this.user}},{key:"hasRole",value:function(e){return this.user&&-1!=this.user.roles.indexOf(e)}},{key:"isAdmin",value:function(){return this.user&&this.hasRole(u.ROLE_ADMIN)}}],[{key:"CreateFromREST",value:function(t,n,r,o,i){var a=new e(t);return a.provider="rest",a.app=r,a.req=o,a.res=i,a.t=o.t,a.user=o.user,a.params=l.defaults({},o.query,o.params,o.body),a.action=n,a}},{key:"CreateFromSocket",value:function(t,n,r,o,i){var a=new e(t);return a.provider="socket",a.app=r,a.socket=o,a.t=r.t,a.user=o.request.user,a.params=i||{},a.action=n,a}},{key:"CreateFromGraphQL",value:function(t,n,r,o,i){var a=new e(t);return a.provider="graphql",a.t=i.t,a.params=o,a.user=i.user,a.action=n,i.ctx=a,a}},{key:"CreateToServiceInit",value:function(t){var n=new e(t);return n.provider="",n.app=t.$app,n}}]),e}();e.exports=p},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("express-list-endpoints")},function(e,t){e.exports=require("cli-table2")},function(e,t){e.exports=require("graphql")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DirectiveLocation=t.BREAK=t.getVisitFn=t.visitWithTypeInfo=t.visitInParallel=t.visit=t.Source=t.print=t.parseType=t.parseValue=t.parse=t.TokenKind=t.createLexer=t.Kind=t.getLocation=void 0;var r=n(24);Object.defineProperty(t,"getLocation",{enumerable:!0,get:function(){return r.getLocation}});var o=n(34);Object.defineProperty(t,"createLexer",{enumerable:!0,get:function(){return o.createLexer}}),Object.defineProperty(t,"TokenKind",{enumerable:!0,get:function(){return o.TokenKind}});var i=n(119);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return i.parse}}),Object.defineProperty(t,"parseValue",{enumerable:!0,get:function(){return i.parseValue}}),Object.defineProperty(t,"parseType",{enumerable:!0,get:function(){return i.parseType}});var a=n(120);Object.defineProperty(t,"print",{enumerable:!0,get:function(){return a.print}});var s=n(38);Object.defineProperty(t,"Source",{enumerable:!0,get:function(){return s.Source}});var u=n(41);Object.defineProperty(t,"visit",{enumerable:!0,get:function(){return u.visit}}),Object.defineProperty(t,"visitInParallel",{enumerable:!0,get:function(){return u.visitInParallel}}),Object.defineProperty(t,"visitWithTypeInfo",{enumerable:!0,get:function(){return u.visitWithTypeInfo}}),Object.defineProperty(t,"getVisitFn",{enumerable:!0,get:function(){return u.getVisitFn}}),Object.defineProperty(t,"BREAK",{enumerable:!0,get:function(){return u.BREAK}});var c=n(40);Object.defineProperty(t,"DirectiveLocation",{enumerable:!0,get:function(){return c.DirectiveLocation}});var l=n(39),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(l);t.Kind=d},function(e,t,n){"use strict";function r(e,t,n){return new o.GraphQLError("Syntax Error: "+n,void 0,e,[t])}Object.defineProperty(t,"__esModule",{value:!0}),t.syntaxError=r;var o=n(25)},function(e,t,n){"use strict";function r(e,t,n){return e&&Array.isArray(e.path)?e:new o.GraphQLError(e&&e.message,e&&e.nodes||t,e&&e.source,e&&e.positions,n,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.locatedError=r;var o=n(25)},function(e,t,n){"use strict";function r(e){return e||(0,a.default)(0,"Received null or undefined error."),o({},e.extensions,{message:e.message||"An unknown error occurred.",locations:e.locations,path:e.path})}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.formatError=r;var i=n(37),a=function(e){return e&&e.__esModule?e:{default:e}}(i)},function(e,t,n){"use strict";function r(e){for(var t=e.split(/\r\n|[\n\r]/g),n=null,r=1;r<t.length;r++){var a=t[r],s=o(a);if(s<a.length&&(null===n||s<n)&&0===(n=s))break}if(n)for(var u=1;u<t.length;u++)t[u]=t[u].slice(n);for(;t.length>0&&i(t[0]);)t.shift();for(;t.length>0&&i(t[t.length-1]);)t.pop();return t.join("\n")}function o(e){for(var t=0;t<e.length&&(" "===e[t]||"\t"===e[t]);)t++;return t}function i(e){return o(e)===e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";function r(e,t){var n="string"==typeof e?new Ee.Source(e):e;if(!(n instanceof Ee.Source))throw new TypeError("Must provide Source. Received: "+String(n));return s((0,Ie.createLexer)(n,t||{}))}function o(e,t){var n="string"==typeof e?new Ee.Source(e):e,r=(0,Ie.createLexer)(n,t||{});ve(r,Ie.TokenKind.SOF);var o=w(r,!1);return ve(r,Ie.TokenKind.EOF),o}function i(e,t){var n="string"==typeof e?new Ee.Source(e):e,r=(0,Ie.createLexer)(n,t||{});ve(r,Ie.TokenKind.SOF);var o=A(r);return ve(r,Ie.TokenKind.EOF),o}function a(e){var t=ve(e,Ie.TokenKind.NAME);return{kind:be.NAME,value:t.value,loc:de(e,t)}}function s(e){var t=e.token;ve(e,Ie.TokenKind.SOF);var n=[];do{n.push(u(e))}while(!me(e,Ie.TokenKind.EOF));return{kind:be.DOCUMENT,definitions:n,loc:de(e,t)}}function u(e){if(fe(e,Ie.TokenKind.NAME))switch(e.token.value){case"query":case"mutation":case"subscription":case"fragment":return c(e);case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"extend":case"directive":return M(e)}else{if(fe(e,Ie.TokenKind.BRACE_L))return c(e);if(L(e))return M(e)}throw ge(e)}function c(e){if(fe(e,Ie.TokenKind.NAME))switch(e.token.value){case"query":case"mutation":case"subscription":return l(e);case"fragment":return I(e)}else if(fe(e,Ie.TokenKind.BRACE_L))return l(e);throw ge(e)}function l(e){var t=e.token;if(fe(e,Ie.TokenKind.BRACE_L))return{kind:be.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:v(e),loc:de(e,t)};var n=d(e),r=void 0;return fe(e,Ie.TokenKind.NAME)&&(r=a(e)),{kind:be.OPERATION_DEFINITION,operation:n,name:r,variableDefinitions:p(e),directives:P(e,!1),selectionSet:v(e),loc:de(e,t)}}function d(e){var t=ve(e,Ie.TokenKind.NAME);switch(t.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw ge(e,t)}function p(e){return fe(e,Ie.TokenKind.PAREN_L)?ke(e,Ie.TokenKind.PAREN_L,f,Ie.TokenKind.PAREN_R):[]}function f(e){var t=e.token;return{kind:be.VARIABLE_DEFINITION,variable:m(e),type:(ve(e,Ie.TokenKind.COLON),A(e)),defaultValue:me(e,Ie.TokenKind.EQUALS)?w(e,!0):void 0,loc:de(e,t)}}function m(e){var t=e.token;return ve(e,Ie.TokenKind.DOLLAR),{kind:be.VARIABLE,name:a(e),loc:de(e,t)}}function v(e){var t=e.token;return{kind:be.SELECTION_SET,selections:ke(e,Ie.TokenKind.BRACE_L,h,Ie.TokenKind.BRACE_R),loc:de(e,t)}}function h(e){return fe(e,Ie.TokenKind.SPREAD)?S(e):g(e)}function g(e){var t=e.token,n=a(e),r=void 0,o=void 0;return me(e,Ie.TokenKind.COLON)?(r=n,o=a(e)):o=n,{kind:be.FIELD,alias:r,name:o,arguments:y(e,!1),directives:P(e,!1),selectionSet:fe(e,Ie.TokenKind.BRACE_L)?v(e):void 0,loc:de(e,t)}}function y(e,t){var n=t?E:k;return fe(e,Ie.TokenKind.PAREN_L)?ke(e,Ie.TokenKind.PAREN_L,n,Ie.TokenKind.PAREN_R):[]}function k(e){var t=e.token;return{kind:be.ARGUMENT,name:a(e),value:(ve(e,Ie.TokenKind.COLON),w(e,!1)),loc:de(e,t)}}function E(e){var t=e.token;return{kind:be.ARGUMENT,name:a(e),value:(ve(e,Ie.TokenKind.COLON),N(e)),loc:de(e,t)}}function S(e){var t=e.token;if(ve(e,Ie.TokenKind.SPREAD),fe(e,Ie.TokenKind.NAME)&&"on"!==e.token.value)return{kind:be.FRAGMENT_SPREAD,name:b(e),directives:P(e,!1),loc:de(e,t)};var n=void 0;return"on"===e.token.value&&(e.advance(),n=C(e)),{kind:be.INLINE_FRAGMENT,typeCondition:n,directives:P(e,!1),selectionSet:v(e),loc:de(e,t)}}function I(e){var t=e.token;return he(e,"fragment"),e.options.experimentalFragmentVariables?{kind:be.FRAGMENT_DEFINITION,name:b(e),variableDefinitions:p(e),typeCondition:(he(e,"on"),C(e)),directives:P(e,!1),selectionSet:v(e),loc:de(e,t)}:{kind:be.FRAGMENT_DEFINITION,name:b(e),typeCondition:(he(e,"on"),C(e)),directives:P(e,!1),selectionSet:v(e),loc:de(e,t)}}function b(e){if("on"===e.token.value)throw ge(e);return a(e)}function w(e,t){var n=e.token;switch(n.kind){case Ie.TokenKind.BRACKET_L:return D(e,t);case Ie.TokenKind.BRACE_L:return _(e,t);case Ie.TokenKind.INT:return e.advance(),{kind:be.INT,value:n.value,loc:de(e,n)};case Ie.TokenKind.FLOAT:return e.advance(),{kind:be.FLOAT,value:n.value,loc:de(e,n)};case Ie.TokenKind.STRING:case Ie.TokenKind.BLOCK_STRING:return T(e);case Ie.TokenKind.NAME:return"true"===n.value||"false"===n.value?(e.advance(),{kind:be.BOOLEAN,value:"true"===n.value,loc:de(e,n)}):"null"===n.value?(e.advance(),{kind:be.NULL,loc:de(e,n)}):(e.advance(),{kind:be.ENUM,value:n.value,loc:de(e,n)});case Ie.TokenKind.DOLLAR:if(!t)return m(e)}throw ge(e)}function T(e){var t=e.token;return e.advance(),{kind:be.STRING,value:t.value,block:t.kind===Ie.TokenKind.BLOCK_STRING,loc:de(e,t)}}function N(e){return w(e,!0)}function O(e){return w(e,!1)}function D(e,t){var n=e.token,r=t?N:O;return{kind:be.LIST,values:ye(e,Ie.TokenKind.BRACKET_L,r,Ie.TokenKind.BRACKET_R),loc:de(e,n)}}function _(e,t){var n=e.token;ve(e,Ie.TokenKind.BRACE_L);for(var r=[];!me(e,Ie.TokenKind.BRACE_R);)r.push(x(e,t));return{kind:be.OBJECT,fields:r,loc:de(e,n)}}function x(e,t){var n=e.token;return{kind:be.OBJECT_FIELD,name:a(e),value:(ve(e,Ie.TokenKind.COLON),w(e,t)),loc:de(e,n)}}function P(e,t){for(var n=[];fe(e,Ie.TokenKind.AT);)n.push(R(e,t));return n}function R(e,t){var n=e.token;return ve(e,Ie.TokenKind.AT),{kind:be.DIRECTIVE,name:a(e),arguments:y(e,t),loc:de(e,n)}}function A(e){var t=e.token,n=void 0;return me(e,Ie.TokenKind.BRACKET_L)?(n=A(e),ve(e,Ie.TokenKind.BRACKET_R),n={kind:be.LIST_TYPE,type:n,loc:de(e,t)}):n=C(e),me(e,Ie.TokenKind.BANG)?{kind:be.NON_NULL_TYPE,type:n,loc:de(e,t)}:n}function C(e){var t=e.token;return{kind:be.NAMED_TYPE,name:a(e),loc:de(e,t)}}function M(e){var t=L(e)?e.lookahead():e.token;if(t.kind===Ie.TokenKind.NAME)switch(t.value){case"schema":return j(e);case"scalar":return F(e);case"type":return B(e);case"interface":return Y(e);case"union":return Q(e);case"enum":return W(e);case"input":return Z(e);case"extend":return te(e);case"directive":return ue(e)}throw ge(e,t)}function L(e){return fe(e,Ie.TokenKind.STRING)||fe(e,Ie.TokenKind.BLOCK_STRING)}function q(e){if(L(e))return T(e)}function j(e){var t=e.token;he(e,"schema");var n=P(e,!0),r=ke(e,Ie.TokenKind.BRACE_L,U,Ie.TokenKind.BRACE_R);return{kind:be.SCHEMA_DEFINITION,directives:n,operationTypes:r,loc:de(e,t)}}function U(e){var t=e.token,n=d(e);ve(e,Ie.TokenKind.COLON);var r=C(e);return{kind:be.OPERATION_TYPE_DEFINITION,operation:n,type:r,loc:de(e,t)}}function F(e){var t=e.token,n=q(e);he(e,"scalar");var r=a(e),o=P(e,!0);return{kind:be.SCALAR_TYPE_DEFINITION,description:n,name:r,directives:o,loc:de(e,t)}}function B(e){var t=e.token,n=q(e);he(e,"type");var r=a(e),o=K(e),i=P(e,!0),s=V(e);return{kind:be.OBJECT_TYPE_DEFINITION,description:n,name:r,interfaces:o,directives:i,fields:s,loc:de(e,t)}}function K(e){var t=[];if("implements"===e.token.value){e.advance();do{t.push(C(e))}while(fe(e,Ie.TokenKind.NAME))}return t}function V(e){return fe(e,Ie.TokenKind.BRACE_L)?ke(e,Ie.TokenKind.BRACE_L,G,Ie.TokenKind.BRACE_R):[]}function G(e){var t=e.token,n=q(e),r=a(e),o=J(e);ve(e,Ie.TokenKind.COLON);var i=A(e),s=P(e,!0);return{kind:be.FIELD_DEFINITION,description:n,name:r,arguments:o,type:i,directives:s,loc:de(e,t)}}function J(e){return fe(e,Ie.TokenKind.PAREN_L)?ke(e,Ie.TokenKind.PAREN_L,$,Ie.TokenKind.PAREN_R):[]}function $(e){var t=e.token,n=q(e),r=a(e);ve(e,Ie.TokenKind.COLON);var o=A(e),i=void 0;me(e,Ie.TokenKind.EQUALS)&&(i=N(e));var s=P(e,!0);return{kind:be.INPUT_VALUE_DEFINITION,description:n,name:r,type:o,defaultValue:i,directives:s,loc:de(e,t)}}function Y(e){var t=e.token,n=q(e);he(e,"interface");var r=a(e),o=P(e,!0),i=V(e);return{kind:be.INTERFACE_TYPE_DEFINITION,description:n,name:r,directives:o,fields:i,loc:de(e,t)}}function Q(e){var t=e.token,n=q(e);he(e,"union");var r=a(e),o=P(e,!0),i=H(e);return{kind:be.UNION_TYPE_DEFINITION,description:n,name:r,directives:o,types:i,loc:de(e,t)}}function H(e){var t=[];if(me(e,Ie.TokenKind.EQUALS)){me(e,Ie.TokenKind.PIPE);do{t.push(C(e))}while(me(e,Ie.TokenKind.PIPE))}return t}function W(e){var t=e.token,n=q(e);he(e,"enum");var r=a(e),o=P(e,!0),i=z(e);return{kind:be.ENUM_TYPE_DEFINITION,description:n,name:r,directives:o,values:i,loc:de(e,t)}}function z(e){return fe(e,Ie.TokenKind.BRACE_L)?ke(e,Ie.TokenKind.BRACE_L,X,Ie.TokenKind.BRACE_R):[]}function X(e){var t=e.token,n=q(e),r=a(e),o=P(e,!0);return{kind:be.ENUM_VALUE_DEFINITION,description:n,name:r,directives:o,loc:de(e,t)}}function Z(e){var t=e.token,n=q(e);he(e,"input");var r=a(e),o=P(e,!0),i=ee(e);return{kind:be.INPUT_OBJECT_TYPE_DEFINITION,description:n,name:r,directives:o,fields:i,loc:de(e,t)}}function ee(e){return fe(e,Ie.TokenKind.BRACE_L)?ke(e,Ie.TokenKind.BRACE_L,$,Ie.TokenKind.BRACE_R):[]}function te(e){var t=e.lookahead();if(t.kind===Ie.TokenKind.NAME)switch(t.value){case"scalar":return ne(e);case"type":return re(e);case"interface":return oe(e);case"union":return ie(e);case"enum":return ae(e);case"input":return se(e)}throw ge(e,t)}function ne(e){var t=e.token;he(e,"extend"),he(e,"scalar");var n=a(e),r=P(e,!0);if(0===r.length)throw ge(e);return{kind:be.SCALAR_TYPE_EXTENSION,name:n,directives:r,loc:de(e,t)}}function re(e){var t=e.token;he(e,"extend"),he(e,"type");var n=a(e),r=K(e),o=P(e,!0),i=V(e);if(0===r.length&&0===o.length&&0===i.length)throw ge(e);return{kind:be.OBJECT_TYPE_EXTENSION,name:n,interfaces:r,directives:o,fields:i,loc:de(e,t)}}function oe(e){var t=e.token;he(e,"extend"),he(e,"interface");var n=a(e),r=P(e,!0),o=V(e);if(0===r.length&&0===o.length)throw ge(e);return{kind:be.INTERFACE_TYPE_EXTENSION,name:n,directives:r,fields:o,loc:de(e,t)}}function ie(e){var t=e.token;he(e,"extend"),he(e,"union");var n=a(e),r=P(e,!0),o=H(e);if(0===r.length&&0===o.length)throw ge(e);return{kind:be.UNION_TYPE_EXTENSION,name:n,directives:r,types:o,loc:de(e,t)}}function ae(e){var t=e.token;he(e,"extend"),he(e,"enum");var n=a(e),r=P(e,!0),o=z(e);if(0===r.length&&0===o.length)throw ge(e);return{kind:be.ENUM_TYPE_EXTENSION,name:n,directives:r,values:o,loc:de(e,t)}}function se(e){var t=e.token;he(e,"extend"),he(e,"input");var n=a(e),r=P(e,!0),o=ee(e);if(0===r.length&&0===o.length)throw ge(e);return{kind:be.INPUT_OBJECT_TYPE_EXTENSION,name:n,directives:r,fields:o,loc:de(e,t)}}function ue(e){var t=e.token,n=q(e);he(e,"directive"),ve(e,Ie.TokenKind.AT);var r=a(e),o=J(e);he(e,"on");var i=ce(e);return{kind:be.DIRECTIVE_DEFINITION,description:n,name:r,arguments:o,locations:i,loc:de(e,t)}}function ce(e){me(e,Ie.TokenKind.PIPE);var t=[];do{t.push(le(e))}while(me(e,Ie.TokenKind.PIPE));return t}function le(e){var t=e.token,n=a(e);if(we.DirectiveLocation.hasOwnProperty(n.value))return n;throw ge(e,t)}function de(e,t){if(!e.options.noLocation)return new pe(t,e.lastToken,e.source)}function pe(e,t,n){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=n}function fe(e,t){return e.token.kind===t}function me(e,t){var n=e.token.kind===t;return n&&e.advance(),n}function ve(e,t){var n=e.token;if(n.kind===t)return e.advance(),n;throw(0,Se.syntaxError)(e.source,n.start,"Expected "+t+", found "+(0,Ie.getTokenDesc)(n))}function he(e,t){var n=e.token;if(n.kind===Ie.TokenKind.NAME&&n.value===t)return e.advance(),n;throw(0,Se.syntaxError)(e.source,n.start,'Expected "'+t+'", found '+(0,Ie.getTokenDesc)(n))}function ge(e,t){var n=t||e.token;return(0,Se.syntaxError)(e.source,n.start,"Unexpected "+(0,Ie.getTokenDesc)(n))}function ye(e,t,n,r){ve(e,t);for(var o=[];!me(e,r);)o.push(n(e));return o}function ke(e,t,n,r){ve(e,t);for(var o=[n(e)];!me(e,r);)o.push(n(e));return o}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=r,t.parseValue=o,t.parseType=i,t.parseConstValue=N,t.parseTypeReference=A,t.parseNamedType=C;var Ee=n(38),Se=n(35),Ie=n(34),be=n(39),we=n(40);pe.prototype.toJSON=pe.prototype.inspect=function(){return{start:this.start,end:this.end}}},function(e,t,n){"use strict";function r(e){return(0,c.visit)(e,{leave:l})}function o(e,t){return e?e.filter(function(e){return e}).join(t||""):""}function i(e){return e&&0!==e.length?s("{\n"+o(e,"\n"))+"\n}":""}function a(e,t,n){return t?e+t+(n||""):""}function s(e){return e&&e.replace(/\n/g,"\n  ")}function u(e,t){return" "!==e[0]&&"\t"!==e[0]||-1!==e.indexOf("\n")?t?'"""\n'+e.replace(/"""/g,'\\"""')+'\n"""':s('"""\n'+e.replace(/"""/g,'\\"""'))+'\n"""':'"""'+e.replace(/"""/g,'\\"""')+'"""'}Object.defineProperty(t,"__esModule",{value:!0}),t.print=r;var c=n(41),l={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return o(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,n=e.name,r=a("(",o(e.variableDefinitions,", "),")"),i=o(e.directives," "),s=e.selectionSet;return n||i||r||"query"!==t?o([t,o([n,r]),i,s]," "):s},VariableDefinition:function(e){return e.variable+": "+e.type+a(" = ",e.defaultValue)},SelectionSet:function(e){return i(e.selections)},Field:function(e){var t=e.alias,n=e.name,r=e.arguments,i=e.directives,s=e.selectionSet;return o([a("",t,": ")+n+a("(",o(r,", "),")"),o(i," "),s]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+a(" ",o(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,n=e.directives,r=e.selectionSet;return o(["...",a("on ",t),o(n," "),r]," ")},FragmentDefinition:function(e){var t=e.name,n=e.typeCondition,r=e.variableDefinitions,i=e.directives,s=e.selectionSet;return"fragment "+t+a("(",o(r,", "),")")+" on "+n+" "+a("",o(i," ")," ")+s},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var n=e.value;return e.block?u(n,"description"===t):JSON.stringify(n)},BooleanValue:function(e){var t=e.value;return JSON.stringify(t)},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+o(e.values,", ")+"]"},ObjectValue:function(e){return"{"+o(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+a("(",o(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:function(e){var t=e.directives,n=e.operationTypes;return o(["schema",o(t," "),i(n)]," ")},OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:function(e){return o([e.description,o(["scalar",e.name,o(e.directives," ")]," ")],"\n")},ObjectTypeDefinition:function(e){var t=e.description,n=e.name,r=e.interfaces,s=e.directives,u=e.fields;return o([t,o(["type",n,a("implements ",o(r,", ")),o(s," "),i(u)]," ")],"\n")},FieldDefinition:function(e){var t=e.description,n=e.name,r=e.arguments,i=e.type,s=e.directives;return o([t,n+a("(",o(r,", "),")")+": "+i+a(" ",o(s," "))],"\n")},InputValueDefinition:function(e){var t=e.description,n=e.name,r=e.type,i=e.defaultValue,s=e.directives;return o([t,o([n+": "+r,a("= ",i),o(s," ")]," ")],"\n")},InterfaceTypeDefinition:function(e){var t=e.description,n=e.name,r=e.directives,a=e.fields;return o([t,o(["interface",n,o(r," "),i(a)]," ")],"\n")},UnionTypeDefinition:function(e){var t=e.description,n=e.name,r=e.directives,i=e.types;return o([t,o(["union",n,o(r," "),i&&0!==i.length?"= "+o(i," | "):""]," ")],"\n")},EnumTypeDefinition:function(e){var t=e.description,n=e.name,r=e.directives,a=e.values;return o([t,o(["enum",n,o(r," "),i(a)]," ")],"\n")},EnumValueDefinition:function(e){return o([e.description,o([e.name,o(e.directives," ")]," ")],"\n")},InputObjectTypeDefinition:function(e){var t=e.description,n=e.name,r=e.directives,a=e.fields;return o([t,o(["input",n,o(r," "),i(a)]," ")],"\n")},ScalarTypeExtension:function(e){return o(["extend scalar",e.name,o(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,n=e.interfaces,r=e.directives,s=e.fields;return o(["extend type",t,a("implements ",o(n,", ")),o(r," "),i(s)]," ")},InterfaceTypeExtension:function(e){var t=e.name,n=e.directives,r=e.fields;return o(["extend interface",t,o(n," "),i(r)]," ")},UnionTypeExtension:function(e){var t=e.name,n=e.directives,r=e.types;return o(["extend union",t,o(n," "),r&&0!==r.length?"= "+o(r," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,n=e.directives,r=e.values;return o(["extend enum",t,o(n," "),i(r)]," ")},InputObjectTypeExtension:function(e){var t=e.name,n=e.directives,r=e.fields;return o(["extend input",t,o(n," "),i(r)]," ")},DirectiveDefinition:function(e){var t=e.description,n=e.name,r=e.arguments,i=e.locations;return o([t,"directive @"+n+a("(",o(r,", "),")")+" on "+o(i," | ")],"\n")}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),a=n(0),s=(n(17),n(3)),u=n(2),c=n(33),l=n(122),d=void 0,p=function(e){i.warn("[Service warn]: "+e)},f=function(e){throw new Error("[Service warn]: "+e)},m=function(){function e(t,o,i){r(this,e);var c=this;t=t||{},c.$schema=t,c.$app=o,c.$db=i,d||(d=n(12)),t.settings||f("No settings of service '"+c.name+"'! Please create a settings object in service schema!");var m=u.defaultsDeep(t.settings,{version:1,namespace:"",internal:!1,rest:!1,ws:!1,graphql:!1,permission:s.PERM_LOGGEDIN,role:s.ROLE_USER,idParamName:"code",modelPropFilter:null});if(c.$settings=m,c.name=m.name,c.version=m.version,c.namespace=m.namespace,c.collection=m.collection,c.name||f("No name of service '"+c.name+"'! Please set in settings of service schema!"),!c.namespace&&(m.rest||m.ws||m.graphql)&&f("No namespace of service '"+c.name+"'! Please set in settings of service schema!"),a.cacheTimeout){var v=a.redis.enabled?"redis":"memory";c.$cacher=new l(v,c.name,a.cacheTimeout)}var h=function(e,t){return function(n){var r=c.getCacheKey(e.name,n.params);return c.getFromCache(r).then(function(e){return null!=e?e:t(n).then(function(e){return c.putToCache(r,e),e})})}};t.actions&&u.isObject(t.actions)&&(c.actions={},u.forIn(t.actions,function(e,t){if(u.isFunction(e)&&(e={handler:e,name:t}),u.isFunction(e.handler)){var n=e.handler.bind(c);e.cache&&(n=h(e,n)),c.actions[t]=n}c.actions[t].settings=e,c.actions[t].settings.name=c.actions[t].settings.name||t,delete c.actions[t].settings.handler})),t.methods&&u.isObject(t.methods)&&u.forIn(t.methods,function(e,t){return-1!=["name","version","namespace","collection","actions"].indexOf(t)?void p("Invalid method name '"+t+"' in '"+c.name+"' service! Skipping..."):-1!=["toJSON","getByID","modelResolver"].indexOf(t)?void p("This method name '"+t+"' is prohibited under 'methods' object. If you want to override the built-in method, please declare in the root of service schema! Skipping..."):void(c[t]=e.bind(c))}),["toJSON","getByID","modelResolver"].forEach(function(e){u.isFunction(t[e])&&(c["__"+e]=c[e],c[e]=t[e].bind(c))})}return o(e,[{key:"toJSON",value:function(e,t){var n=function(e){var n=e.toJSON();return null!=t?u.pick(n,t):n};return null==t&&(t=this.$settings.modelPropFilter),u.isString(t)&&(t=t.split(" ")),u.isArray(e)?u.map(e,function(e){return n(e)}):u.isObject(e)?n(e):void 0}},{key:"populateModels",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments[2],r=arguments[3];if(n=n||this.$settings.modelPopulates,r=r||this.$settings.idEncodes,null!=e&&r&&u.forIn(r,function(t,n){if(u.isString(t)){var r=d.get(t);if(r&&u.isFunction(r.encodeID)){(u.isArray(e)?e:[e]).forEach(function(e){var t=e[n];void 0!=t&&(u.isArray(t)?e[n]=t.map(function(e){return e>0?r.encodeID(e):null}):t>0&&(e[n]=r.encodeID(t)))})}}}),null!=e&&n){var o=[];if(u.forIn(n,function(n,r){if(u.isString(n)){var i=d.get(n);if(i&&u.isFunction(i.getByID)){(u.isArray(e)?e:[e]).forEach(function(e){o.push(i.getByID(e[r],t).then(function(t){e[r]=t}))})}}}),o.length>0)return Promise.all(o).then(function(){return e})}return Promise.resolve(e)}},{key:"getByID",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this.collection||null==e)return Promise.resolve();if(u.isArray(e)&&0==e.length)return Promise.resolve([]);var r=a.cacheTimeout?this.getCacheKey("model",e):null;return Promise.resolve().then(function(){return r?t.getFromCache(r):null}).then(function(o){if(o)return o;var i=void 0;return i=u.isArray(e)?t.collection.find({_id:{$in:e}}):t.collection.findById(e),i.exec().then(function(r){if(u.isArray(r)){var o=r.reduce(function(e,t){return e[t._id]=t,e},{}),i=e.map(function(e){return o[e]}),a=t.toJSON(i);return n?a.filter(function(e){return n(t.name,e)}):a}var s=t.toJSON(r);return n?n(t.name,s)?s:null:s}).then(function(e){return t.populateModels(e,n)}).then(function(e){return r&&t.putToCache(r,u.cloneDeep(e)),e})})}},{key:"modelResolver",value:function(e,t){if(null==this.collection)return Promise.resolve();var n=void 0;return n=u.isFunction(this.collection.schema.methods.decodeID)?this.collection.schema.methods.decodeID(t):t,e.modelID=n,null==n||""==n?e.errorBadRequest(s.ERR_INVALID_CODE,e.t("app:InvalidCode")):this.getByID(n)}},{key:"decodeID",value:function(e){if(u.isFunction(this.collection.schema.methods.decodeID))return this.collection.schema.methods.decodeID(e);throw new Error("'decodeID' method not implemented in '"+this.name+"' service!")}},{key:"encodeID",value:function(e){if(u.isFunction(this.collection.schema.methods.encodeID))return this.collection.schema.methods.encodeID(e);throw new Error("'encodeID' method not implemented in '"+this.name+"' service!")}},{key:"getCacheKey",value:function(e,t){return(e?e+":":"")+(t?c(t):"")}},{key:"getFromCache",value:function(e){return this.$cacher?this.$cacher.get(e):Promise.resolve(null)}},{key:"putToCache",value:function(e,t){return this.$cacher?this.$cacher.set(e,t):Promise.resolve()}},{key:"clearCache",value:function(){return this.$cacher?this.$cacher.clean():Promise.resolve()}},{key:"notifyModelChanges",value:function(e,t,n){e.notifyChanges(t,n,this.$settings.role),d.emit(this.name+":"+t,{ctx:e,payload:n}),this.clearCache()}},{key:"notifyNotSetupYet",value:function(e){console.log("● notifyNotSetupYet"),e.notifyChanges("empty",[],this.$settings.role),d.emit(this.name+":empty",{ctx:e,payload:[]}),this.clearCache()}},{key:"services",value:function(e){return d.get(e)}}]),e}();e.exports=m},function(e,t,n){"use strict";var r=(n(0),n(1),n(18),n(2),n(123)),o=n(124);e.exports=function(e,t,n){switch(e){case"redis":return new o(t,n);default:return new r(t,n)}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n(0),n(1)),a=(n(18),n(2),function(){function e(t,n){var o=this;r(this,e),this.cache={},this.prefix=t?t+":":"",this.ttl=n,n&&(this.timer=setInterval(function(){o.checkTTL()},3e4))}return o(e,[{key:"get",value:function(e){var t=this;return new Promise(function(n,r){var o=t.cache[t.prefix+e];o?(i.debug("[Cacher] GET "+t.prefix+e),n(o.data),o.expire=Date.now()+1e3*t.ttl):n(null)})}},{key:"set",value:function(e,t){return this.cache[this.prefix+e]={data:t,expire:Date.now()+1e3*this.ttl},i.debug("[Cacher] SET "+this.prefix+e),Promise.resolve(t)}},{key:"del",value:function(e){return delete this.cache[this.prefix+e],i.debug("[Cacher] DEL "+this.prefix+e),Promise.resolve()}},{key:"clean",value:function(e){return i.debug("[Cacher] CLEAR "+this.prefix+"*"),this.cache={},Promise.resolve()}},{key:"checkTTL",value:function(){var e=this,t=this,n=Date.now();Object.keys(this.cache).forEach(function(r){var o=e.cache[r];o.expire&&o.expire<n&&(i.debug("[Cacher] EXPIRED "+r),delete t.cache[r])})}}]),e}());e.exports=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n(0),n(1)),a=n(18),s=n(2),u=function(){function e(t,n){r(this,e),i.debug("Redis Cacher created. Prefix: "+t),this.prefix=t?t+":":"",this.ttl=n}return o(e,[{key:"get",value:function(e){return a.get(this.prefix+e).then(function(e){if(e)try{return JSON.parse(e)}catch(e){i.error("Redis result parse error!",e)}return e})}},{key:"set",value:function(e,t){return s.isObject(t)&&(t=JSON.stringify(t)),this.ttl?a.setex(this.prefix+e,this.ttl,t):a.set(this.prefix+e,t)}},{key:"del",value:function(e){return a.del(this.prefix+e,function(e){e&&i.error("Redis `del` error!",e)}),Promise.resolve()}},{key:"clean",value:function(e){var t=this;return function n(r,o){a.scan(r,"MATCH",t.prefix+(e||"*"),"COUNT",100,function(e,t){if(e)return o(e);var r=parseInt(t[0]),i=t[1];if(!r&&!i.length)return o(null);a.del(i,function(e){return e?o(e):r?void n(r,o):o(null)})})}(0,function(e){e&&i.error("Redis `scanDel` error!",e)}),Promise.resolve()}}]),e}();e.exports=u},function(e,t,n){function r(e){return n(o(e))}function o(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./mailer.js":126};r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id=125},function(e,t,n){"use strict";var r=n(1),o=n(0),i=(n(3),n(42)),a=n(43).htmlToText;e.exports={settings:{name:"mailer",internal:!0},methods:{send:function(e,t,s){return new Promise(function(u,c){r.info("Sending email to "+e+" with subject "+t+"...");var l={};e instanceof Object?e instanceof Array?l.to=e:l=e:l.to=e;var d={from:o.mailer.from,to:l.to,cc:l.cc,bcc:l.bcc,subject:t,html:s},p=void 0;if("smtp"==o.mailer.transport)p=i.createTransport(o.mailer.smtp);else if("mailgun"==o.mailer.transport){var f=n(44);p=i.createTransport(f({auth:{api_key:o.mailer.mailgun.apiKey,domain:o.mailer.mailgun.domain}}))}else if("sendgrid"==o.mailer.transport){var m=n(45);p=i.createTransport(m({auth:{api_key:o.mailer.sendgrid.apiKey}}))}p?(p.use("compile",a()),p.sendMail(d,function(e,t){e?(r.warn("Unable to send email: ",e),c(e)):(r.info("Email message sent.",t.response),u(t))})):c(new Error("Unable to send email! Invalid mailer transport: "+o.mailer.transport))})}},init:function(e){}}},function(e,t,n){function r(e){return n(o(e))}function o(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./comment/service.js":128,"./counter/service.js":130,"./devices/service.js":132,"./groups/service.js":134,"./persons/service.js":135,"./posts/service.js":136,"./profile/service.js":138,"./reviews/service.js":140,"./session/service.js":143,"./tasks/service.js":144,"./works/service.js":145};r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id=127},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=(n(2),n(129)),i=n(26),a=n(46);e.exports={settings:{name:"comments",version:1,namespace:"comments",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code description work review replies author createdAt updatedAt",modelPopulates:{replies:"comments"},idEncodes:{work:"works",review:"reviews",author:"persons"}},actions:{find:{cache:!0,handler:function(e){var t=this,n={};e.params.date?n.date=e.params.date:n={author:this.personService.decodeID(e.params.user_code),week:e.params.week};var r=a.find(n);return e.queryPageSort(r).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:TaskNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new o({description:e.params.description,work:e.params.work_code?this.workService.decodeID(e.params.work_code):null,review:e.params.review_code?this.reviewService.decodeID(e.params.review_code):null,author:e.user.id}).save().then(function(e){return e.work?i.findById(e.work).exec().then(function(t){null==t.comments?t.comments=[e.id]:t.comments.push(e.id),t.save()}):e.review&&a.findById(e.review).exec().then(function(t){null==t.comments?t.comments=[e.id]:t.comments.push(e.id),t.save()}),e}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",n),n})},update:function(e){},remove:function(e){}},methods:{validateParams:function(e,t){if((t||e.hasParam("description"))&&e.validateParam("description").trim().notEmpty(e.t("app:CommentDescriptionCannotBeBlank")).end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){this.workService=e.services("works"),this.reviewService=e.services("reviews")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tcomments(limit: Int, offset: Int, sort: String): [Comment]\n\t\t\tcomment(code: String): Comment\n\t\t",types:"\n\t\t\ttype Comment {\n\t\t\t\tcode: String!\n\t\t\t\tpurpose: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tgoal: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n            commentCreate(name: String!, purpose: String, type: String, goal: String, status: Int): Comment\n\t\t\tcommentUpdate(code: String!, name: String, purpose: String, type: String, goal: String, status: Int): Comment\n\t\t\tcommentRemove(code: String!): Comment\n\t\t",resolvers:{Query:{comments:"find",comment:"get"},Mutation:{commentCreate:"create",commentUpdate:"update",commentRemove:"remove"}}}}},function(e,t,n){"use strict";var r=(n(0),n(1),n(8),n(6)),o=r.Schema,i=n(11)("comments"),a=n(9),s={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new o({description:{type:String,trim:!0},work:{type:Number,ref:"Work"},review:{type:Number,ref:"Review"},replies:[{type:Number,ref:"Comment"}],author:{type:Number,required:"Please fill in an author ID",ref:"User"},isDeleted:{type:Number,default:0},metadata:{}},s);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(a.plugin,{model:"Comment",startAt:1}),u.methods.encodeID=function(e){return e=e||this._id,i.encodeHex(e)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Comment",u);e.exports=c},function(e,t,n){"use strict";var r=n(1),o=(n(0),n(3)),i=n(131);e.exports={settings:{name:"counter",version:1,namespace:"counter",rest:!0,ws:!0,permission:o.PERM_LOGGEDIN},actions:{find:{cache:!0,handler:function(e){return Promise.resolve(i.counter)}},create:function(e){if(e.params.value)return this.changeCounter(e,parseInt(e.params.value));throw new Error("Missing value from request!")},reset:{permission:o.PERM_ADMIN,handler:function(e){return this.changeCounter(e,0)}},increment:function(e){return this.changeCounter(e,i.counter+1)},decrement:function(e){return this.changeCounter(e,i.counter-1)}},methods:{changeCounter:function(e,t){return i.counter=t,r.info(e.user.username+" changed the counter to ",i.counter),this.notifyModelChanges(e,"changed",i.counter),Promise.resolve(i.counter)}},init:function(e){},socket:{afterConnection:function(e,t){e.emit("/counter/changed",i.counter)}},graphql:{query:"\n\t\t\tcounter: Int\n\t\t",types:"",mutation:"\n\t\t\tcounterCreate(value: Int!): Int\n\t\t\tcounterReset: Int\n\t\t\tcounterIncrement: Int\n\t\t\tcounterDecrement: Int\n\t\t",resolvers:{Query:{counter:"find"},Mutation:{counterCreate:"create",counterReset:"reset",counterIncrement:"increment",counterDecrement:"decrement"}}}}},function(e,t,n){"use strict";e.exports={counter:0}},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=(n(2),n(133));e.exports={settings:{name:"devices",version:1,namespace:"devices",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code type address name description status lastCommunication createdAt updatedAt"},actions:{find:{cache:!0,handler:function(e){var t=this,n={},r=o.find(n);return e.queryPageSort(r).exec().then(function(e){return t.toJSON(e)})}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:DeviceNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new o({address:e.params.address,type:e.params.type,name:e.params.name,description:e.params.description,status:e.params.status}).save().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",n),n})},update:function(e){var t=this;return e.assertModelIsExist(e.t("app:DeviceNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then(function(t){return null!=e.params.address&&(t.address=e.params.address),null!=e.params.type&&(t.type=e.params.type),null!=e.params.name&&(t.name=e.params.name),null!=e.params.description&&(t.description=e.params.description),null!=e.params.status&&(t.status=e.params.status),t.save()}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})},remove:function(e){var t=this;return e.assertModelIsExist(e.t("app:DeviceNotFound")),o.remove({_id:e.modelID}).then(function(){return e.model}).then(function(n){return t.notifyModelChanges(e,"removed",n),n})}},methods:{validateParams:function(e,t){if((t||e.hasParam("name"))&&e.validateParam("name").trim().notEmpty(e.t("app:DeviceNameCannotBeBlank")).end(),(t||e.hasParam("status"))&&e.validateParam("status").isNumber(),e.validateParam("description").trim().end(),e.validateParam("address").trim().end(),e.validateParam("type").trim().end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tdevices(limit: Int, offset: Int, sort: String): [Device]\n\t\t\tdevice(code: String): Device\n\t\t",types:"\n\t\t\ttype Device {\n\t\t\t\tcode: String!\n\t\t\t\taddress: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tdescription: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tdeviceCreate(name: String!, address: String, type: String, description: String, status: Int): Device\n\t\t\tdeviceUpdate(code: String!, name: String, address: String, type: String, description: String, status: Int): Device\n\t\t\tdeviceRemove(code: String!): Device\n\t\t",resolvers:{Query:{devices:"find",device:"get"},Mutation:{deviceCreate:"create",deviceUpdate:"update",deviceRemove:"remove"}}}}},function(e,t,n){"use strict";var r=(n(0),n(1),n(8),n(6)),o=r.Schema,i=n(11)("devices"),a=n(9),s={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new o({address:{type:String,trim:!0},type:{type:String,trim:!0},name:{type:String,trim:!0},description:{type:String,trim:!0,default:""},status:{type:Number,default:1},lastCommunication:{type:Date,default:Date.now},metadata:{}},s);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(a.plugin,{model:"Device",startAt:1}),u.methods.encodeID=function(){return i.encodeHex(this._id)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Device",u);e.exports=c},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=(n(2),n(47)),i=n(27),a=[{name:"Conducive-Urgent",purpose:"for_the_top_priority_tasks"},{name:"Conducive-Unurgent",purpose:"for_the_tasks_you_should_give_priority_to"},{name:"Unconducive-Urgent",purpose:"for_the_tasks_you_should_doubt_their_priority"},{name:"Unconducive-Unurgent",purpose:"for_the_tasks_you_should_not_do"}],s=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return n.push(t),t.children&&t.children.length>0&&(n=t.children.reduce(function(t,n){return e(n,t)},n)),n},u=function e(t,n){if(n.children.length>0)for(var r in n.children){var o=n.children[r];if(o.code==t.code||e(t,o))return!0}return!1},c=function e(t,n){return t.map(function(t){return t.children=t.children.filter(function(e){return!n.includes(e.code)}),t.children=e(t.children,n),t})};e.exports={settings:{name:"groups",version:1,namespace:"groups",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code type purpose name parent children author lastCommunication createdAt updatedAt",modelPopulates:{children:"tasks"},idEncodes:{parent:"tasks",author:"persons"}},actions:{find:{cache:!0,handler:function(e){var t=this;if(void 0!=e.params.parent_code){var n=e.params.parent_code,r=this.taskService.decodeID(n);return this.taskService.getByID(r).then(function(i){var a={type:"kanban",parent:r},s=o.find(a);return e.queryPageSort(s).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(e){var t=e.reduce(function(e,t){return e.concat(t.children.map(function(e){return e.code}))},[]),r=function e(n,r){return n.children=n.children.filter(function(e){return!(e.status<0||t.includes(e.code))}).map(function(t){return e(t,r)}),n};return i.children.reduce(function(e,o){return o.status<0||t.includes(o.code)?e:(o=r(o,t),"milestone"==o.type?e.push({code:"MILESTONE-"+o.code,type:"kanban",name:o.name,purpose:"for_classify",parent:n,children:o.children}):e[0].children.push(o),e)},[{code:"UNCLASSIFIED",type:"kanban",name:"unclassified",purpose:"for_classify",parent:n,children:[]}]).concat(e)})})}if(void 0!=e.params.weekly){var l="weekly_"+e.params.weekly,d=e.params.user_code?this.personService.decodeID(e.params.user_code):e.user.id,p={$and:[{author:d},{type:l}]},f=function(e,t){return"tasks"!=e||t.status>-1&&["requirement","way","step","todo"].includes(t.type)&&(t.author==d||t.asignee==d)},m=o.find(p);return e.queryPageSort(m).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e,f)}).then(function(n){var r={status:{$gt:-1},type:{$in:["requirement","way","step","todo"]},$or:[{author:d},{asignee:d}]},p=i.find(r);return e.queryPageSort(p).exec().then(function(e){return t.taskService.toJSON(e)}).then(function(e){return t.taskService.populateModels(e,f)}).then(function(r){if(0==n.length)return a.reduce(function(e,t){return e.then(function(e){return t.type=l,t.parent=-1,t.author=d,new o(t).save().then(function(t){return e.push(t),e})})},Promise.resolve([])).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(e){r=r.reduce(function(e,t){var n=r.filter(function(e){return e.code!=t.code});for(var o in n){var i=n[o];if(u(t,i))return e}return e.push(t),e},[]);var t={code:"UNCLASSIFIED",type:l,name:"unclassified",purpose:"for_classify",children:r};return e.unshift(t),e});var i=n.reduce(function(e,t){return t.children.reduce(function(e,t){return e.concat(s(t))},e)},[]).map(function(e){return e.code}),p=r.filter(function(e){return!i.includes(e.code)});p=p.reduce(function(e,t){var n=p.filter(function(e){return e.code!=t.code});for(var r in n){var o=n[r];if(u(t,o))return e}return e.push(t),e},[]),p=c(p,i);var f={code:"UNCLASSIFIED",type:"weekly_"+e.params.weekly,name:"unclassified",purpose:"for_classify",children:p};return n.unshift(f),n})})}if(void 0!=e.params.daily){var v="weekly_"+e.params.daily,h=e.params.user_code?this.personService.decodeID(e.params.user_code):e.user.id,g={$and:[{author:h},{type:v}]},y=function(e,t){return"tasks"!=e||t.status>-1&&(t.author==h||t.asignee==h)},k=o.find(g);return e.queryPageSort(k).exec().then(function(e){return t.toJSON(e)}).then(function(e){return 0==e.length?a.reduce(function(e,t){return e.then(function(e){return t.type=v,t.parent=-1,t.author=h,new o(t).save().then(function(t){return e.push(t),e})})},Promise.resolve([])).then(function(e){return[{code:"ASSIGNED_IN_WEEKLY",type:v,name:"assignedInWeekly",purpose:"for_assigning",children:[]}]}):t.populateModels(e,y).then(function(e){var t=e.reduce(function(e,t){return e.concat(t.children)},[]);return[{code:"ASSIGNED_IN_WEEKLY",type:v,name:"assignedInWeekly",purpose:"for_assigning",children:t}]})})}}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:GroupNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new o({type:e.params.type,name:e.params.name,purpose:e.params.purpose,parent:void 0!==e.params.parent_code?this.taskService.decodeID(e.params.parent_code):-1,author:e.user.id}).save().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",{user:e.user,json:n}),n})},update:function(e){var t=this;e.assertModelIsExist(e.t("app:GroupNotFound")),this.validateParams(e);var n=this.taskService.decodeID(e.params.task),r=e.params.index;return console.log("● update",e.modelID,n,r,e.params.from),Promise.resolve().then(function(){if(e.params.from){var o=e.modelID,i=t.decodeID(e.params.from);return o!=i?t.collection.findById(o).exec().then(function(o){return o.children.splice(r,0,n),o.save().then(function(r){return t.collection.findById(i).exec().then(function(e){return e.children=e.children.filter(function(e){return e!=n}),e.save()}).then(function(n){return t.actions.find(e)})})}):t.collection.findById(o).exec().then(function(o){return o.children=o.children.filter(function(e){return e!=n}),o.children.splice(r,0,n),o.save().then(function(n){return t.actions.find(e)})})}if(e.params.remove){var a=e.modelID;return t.collection.findById(a).exec().then(function(e){return e.children=e.children.filter(function(e){return e!=n}),e.save()}).then(function(n){return t.actions.find(e)})}var s=e.modelID;return t.collection.findById(s).exec().then(function(o){return o.children.splice(r,0,n),o.save().then(function(n){return t.actions.find(e)})})}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})},remove:function(e){var t=this;return e.assertModelIsExist(e.t("app:GroupNotFound")),i.remove({_id:e.modelID}).then(function(){return e.model}).then(function(n){return t.notifyModelChanges(e,"removed",n),n})}},methods:{validateParams:function(e,t){if((t||e.hasParam("name"))&&e.validateParam("name").trim().notEmpty(e.t("app:GroupNameCannotBeBlank")).end(),e.validateParam("purpose").trim().end(),e.validateParam("type").trim().end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){this.taskService=e.services("tasks"),this.personService=e.services("persons")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tgroups(limit: Int, offset: Int, sort: String): [Task]\n\t\t\tgroup(code: String): Task\n\t\t",types:"\n\t\t\ttype Group {\n\t\t\t\tcode: String!\n\t\t\t\tpurpose: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tgroupCreate(name: String!, purpose: String, type: String, goal: String, status: Int): Group\n\t\t\tgroupUpdate(code: String!, name: String, purpose: String, type: String, goal: String, status: Int): Group\n\t\t\tgroupRemove(code: String!): Group\n\t\t",resolvers:{Query:{groups:"find",group:"get"},Mutation:{groupCreate:"create",groupUpdate:"update",groupRemove:"remove"}}}}},function(e,t,n){"use strict";var r=(n(1),n(0),n(17),n(3)),o=(n(2),n(48));e.exports={settings:{name:"persons",version:1,namespace:"persons",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code username fullName avatar lastLogin roles"},actions:{find:{cache:!0,handler:function(e){var t=this;return e.queryPageSort(o.find({})).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:UserNotFound")),Promise.resolve(e.model)}}},methods:{},graphql:{query:"\n\t\t\t# users(limit: Int, offset: Int, sort: String): [Person]\n\t\t\tperson(code: String): Person\n\t\t",types:"\n\t\t\ttype Person {\n\t\t\t\tcode: String!\n\t\t\t\tfullName: String\n\t\t\t\tusername: String\n\t\t\t\troles: [String]\n\t\t\t\tavatar: String\n\t\t\t\tlastLogin: Timestamp\n\n\t\t\t\tposts(limit: Int, offset: Int, sort: String): [Post]\n\t\t\t}\n\t\t",mutation:"\n\t\t",resolvers:{Query:{person:"get"},Person:{posts:function(e,t,n){var r=n.ctx,o=r.services("posts");if(o)return o.actions.find(r.copy(Object.assign(t,{author:e.code})))}}}}}},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=(n(2),n(137));e.exports={settings:{name:"posts",version:1,namespace:"posts",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code title content author votes voters views createdAt editedAt",modelPopulates:{author:"persons",voters:"persons"}},actions:{find:{cache:!0,handler:function(e){var t=this,n={};"my"==e.params.filter?n.author=e.user.id:null!=e.params.author&&(n.author=this.personService.decodeID(e.params.author));var r=o.find(n);return e.queryPageSort(r).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}},get:{cache:!0,permission:r.PERM_PUBLIC,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),o.findByIdAndUpdate(e.modelID,{$inc:{views:1}}).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}},create:{handler:function(e){var t=this;return this.validateParams(e,!0),new o({title:e.params.title,content:e.params.content,author:e.user.id}).save().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",n),n})}},update:{permission:r.PERM_OWNER,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then(function(t){return null!=e.params.title&&(t.title=e.params.title),null!=e.params.content&&(t.content=e.params.content),t.editedAt=Date.now(),t.save()}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})}},remove:{permission:r.PERM_OWNER,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),o.remove({_id:e.modelID}).then(function(){return e.model}).then(function(n){return t.notifyModelChanges(e,"removed",n),n})}},vote:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.collection.findById(e.modelID).exec().then(function(t){if(-1!==t.voters.indexOf(e.user.id))throw e.errorBadRequest(r.ERR_ALREADY_VOTED,e.t("app:YouHaveAlreadyVotedThisPost"));return t}).then(function(t){return o.findByIdAndUpdate(t.id,{$addToSet:{voters:e.user.id},$inc:{votes:1}},{new:!0})}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"voted",n),n})},unvote:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.collection.findById(e.modelID).exec().then(function(t){if(-1==t.voters.indexOf(e.user.id))throw e.errorBadRequest(r.ERR_NOT_VOTED_YET,e.t("app:YouHaveNotVotedThisPostYet"));return t}).then(function(t){return o.findByIdAndUpdate(t.id,{$pull:{voters:e.user.id},$inc:{votes:-1}},{new:!0})}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"unvoted",n),n})}},methods:{validateParams:function(e,t){if((t||e.hasParam("title"))&&e.validateParam("title").trim().notEmpty(e.t("app:PostTitleCannotBeEmpty")).end(),(t||e.hasParam("content"))&&e.validateParam("content").trim().notEmpty(e.t("app:PostContentCannotBeEmpty")).end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},ownerChecker:function(e){return new Promise(function(t,n){e.assertModelIsExist(e.t("app:PostNotFound")),e.model.author.code==e.user.code||e.isAdmin()?t():n()})},init:function(e){this.personService=e.services("persons"),r.append(["ALREADY_VOTED","NOT_VOTED_YET"],"ERR")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tposts(limit: Int, offset: Int, sort: String): [Post]\n\t\t\tpost(code: String): Post\n\t\t",types:"\n\t\t\ttype Post {\n\t\t\t\tcode: String!\n\t\t\t\ttitle: String\n\t\t\t\tcontent: String\n\t\t\t\tauthor: Person!\n\t\t\t\tviews: Int\n\t\t\t\tvotes: Int,\n\t\t\t\tvoters(limit: Int, offset: Int, sort: String): [Person]\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tpostCreate(title: String!, content: String!): Post\n\t\t\tpostUpdate(code: String!, title: String, content: String): Post\n\t\t\tpostRemove(code: String!): Post\n\n\t\t\tpostVote(code: String!): Post\n\t\t\tpostUnvote(code: String!): Post\n\t\t",resolvers:{Query:{posts:"find",post:"get"},Mutation:{postCreate:"create",postUpdate:"update",postRemove:"remove",postVote:"vote",postUnvote:"unvote"}}}}},function(e,t,n){"use strict";var r=(n(0),n(1),n(2),n(8),n(6)),o=r.Schema,i=n(11)("posts"),a=n(9),s={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new o({title:{type:String,trim:!0},content:{type:String,trim:!0},author:{type:Number,required:"Please fill in an author ID",ref:"User"},views:{type:Number,default:0},voters:[{type:Number,ref:"User"}],votes:{type:Number,default:0},editedAt:{type:Date},metadata:{}},s);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(a.plugin,{model:"Post",startAt:1}),u.methods.encodeID=function(){return i.encodeHex(this._id)},u.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Post",u);e.exports=c},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=(n(2),n(139));e.exports={settings:{name:"profile",version:1,namespace:"profile",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code username fullName email avatar passwordLess provider profile socialLinks roles apiKey lastLogin locale status credentials createdAt updatedAt"},actions:{get:{cache:!1,handler:function(e){var t=this;return o.findById(o.schema.methods.decodeID(e.user.code)).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}}},methods:{},graphql:{query:"\n\t\t\tprofile: Profile\n\t\t",types:"\n\t\t\ttype Profile {\n\t\t\t\tcode: String!\n\t\t\t\tfullName: String\n\t\t\t\temail: String\n\t\t\t\tusername: String\n\t\t\t\tpasswordLess: Boolean\n\t\t\t\tprovider: String\n\t\t\t\tprofile: SocialProfile\n\t\t\t\tsocialLinks: SocialLinks\n\t\t\t\troles: [String]\n\t\t\t\tverified: Boolean\n\t\t\t\tapiKey: String\n\t\t\t\tlocale: String\n\t\t\t\tavatar: String\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t\tupdatedAt: Timestamp\n\t\t\t\tlastLogin: Timestamp\n\t\t\t\tstatus: Boolean\n\t\t\t}\n\n\t\t\ttype SocialProfile {\n\t\t\t\tname: String\n\t\t\t\tgender: String\n\t\t\t\tpicture: String\n\t\t\t\tlocation: String\n\t\t\t}\n\n\t\t\ttype SocialLinks {\n\t\t\t\tfacebook: String\n\t\t\t\ttwitter: String\n\t\t\t\tgoogle: String\n\t\t\t\tgithub: String\n\t\t\t}\n\t\t",mutation:"\n\t\t",resolvers:{Query:{profile:"get"}}}}},function(e,t,n){"use strict";e.exports=n(4)},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=n(141),i=(n(2),n(46)),a=n(26);e.exports={settings:{name:"reviews",version:1,namespace:"reviews",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:i,modelPropFilter:"code week date works highOrderAwakening comments author createdAt updatedAt",modelPopulates:{comments:"comments"},idEncodes:{works:"works",author:"persons"}},actions:{find:{cache:!0,handler:function(e){var t=this,n={};e.params.date?n.date=e.params.date:n={author:this.personService.decodeID(e.params.user_code),week:e.params.week};var r=i.find(n);return e.queryPageSort(r).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:TaskNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new i({week:e.params.week,date:e.params.date,highOrderAwakening:e.params.highOrderAwakening,works:e.params.works.map(function(e){return t.workService.decodeID(e)}),author:e.user.id}).save().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",n),o.postMessage(e.user.username+" が日次レビューをした！"),n})},update:function(e){var t=this;return e.assertModelIsExist(e.t("app:WorkNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then(function(t){return console.log(e.params),null!=e.params.name&&(t.name=e.params.name),null!=e.params.goal&&(t.goal=e.params.goal),null!=e.params.start&&(t.start=e.params.start),null!=e.params.end&&(t.end=e.params.end),null!=e.params.actualStart&&(t.actualStart=e.params.actualStart),null!=e.params.actualEnd&&(t.actualEnd=e.params.actualEnd),null!=e.params.description&&(t.description=e.params.description),null!=e.params.status&&(t.status=e.params.status),t.save()}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})},remove:function(e){var t=this;return e.assertModelIsExist(e.t("app:TaskNotFound")),a.remove({_id:e.modelID}).then(function(){return e.model}).then(function(n){return t.notifyModelChanges(e,"removed",n),n})}},methods:{validateParams:function(e,t){if((t||e.hasParam("week"))&&e.validateParam("week").trim().notEmpty(e.t("app:ReviewWeekCannotBeBlank")).end(),(t||e.hasParam("date"))&&e.validateParam("date").trim().notEmpty(e.t("app:ReviewDateCannotBeBlank")).end(),(t||e.hasParam("works"))&&e.validateParam("works").notEmpty(e.t("app:ReviewworksCannotBeBlank")).end(),(t||e.hasParam("highOrderAwakening"))&&e.validateParam("highOrderAwakening").trim().notEmpty(e.t("app:ReviewHighOrderAwakeningCannotBeBlank")).end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){this.workService=e.services("works"),this.personService=e.services("persons")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\treviews(limit: Int, offset: Int, sort: String): [Review]\n\t\t\treview(code: String): Review\n\t\t",types:"\n\t\t\ttype Review {\n\t\t\t\tcode: String!\n\t\t\t\tpurpose: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tgoal: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n            reviewCreate(name: String!, purpose: String, type: String, goal: String, status: Int): Review\n\t\t\treviewUpdate(code: String!, name: String, purpose: String, type: String, goal: String, status: Int): Review\n\t\t\treviewRemove(code: String!): Review\n\t\t",resolvers:{Query:{reviews:"find",review:"get"},Mutation:{reviewCreate:"create",reviewUpdate:"update",reviewRemove:"remove"}}}}},function(e,t,n){"use strict";function r(e){var t={url:o,json:!0,form:'payload={"text": "'+e+'"}'};return new Promise(function(e,n){i.post(t,function(t,r,o){return t?n(t):r.statusCode>=400?n("Response error:"+r.statusCode+" "+r.statusMessage):e(o)})})}var o="https://hooks.slack.com/services/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",i=(n(2),n(142));e.exports={postMessage:r}},function(e,t){e.exports=require("request")},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=n(2),i=n(17),a=void 0;e.exports={settings:{name:"session",version:1,namespace:"session",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user"},actions:{me:function(e){return Promise.resolve(e.user).then(function(e){return a.toJSON(e)})},onlineUsers:function(e){return Promise.resolve().then(function(){return a.toJSON(o.map(i.userSockets,function(e){return e.request.user}))})}},init:function(e){a=this.services("persons")},graphql:{query:"\n\t\t\tme: Person\n\t\t\tonlineUsers: [Person]\n\t\t",mutation:"\n\t\t",resolvers:{Query:{me:"me",onlineUsers:"onlineUsers"}}}}},function(e,t,n){"use strict";var r=(n(1),n(0),n(3)),o=(n(2),n(27)),i=n(47),a=[{name:"TODO",purpose:"for_the_tasks_to_do_from_now"},{name:"IN_PROGRESS",purpose:"for_the_tasks_now_people_doing"},{name:"DONE",purpose:"for_the_tasks_finished_already"}];e.exports={settings:{name:"tasks",version:1,namespace:"tasks",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code type purpose name shortname goal description deadline timeframe root parent children works status closingComment author asignee isDeleted lastCommunication createdAt updatedAt",modelPopulates:{children:"tasks",works:"works",author:"persons",asignee:"persons"},idEncodes:{root:"tasks",parent:"tasks"}},actions:{find:{cache:!0,handler:function(e){var t=this;if(e.params.check)return this.actions.check(e);var n={},r=null;if(void 0!=e.params.type)n.type=e.params.type,n.isDeleted={$ne:!0},n.status={$gt:-1},r=function(e,t){return"tasks"!=e||t.status>-1};else if(void 0!=e.params.root_code)n.root=this.decodeID(e.params.root_code),n.isDeleted={$ne:!0},n.status={$gt:-1};else if(void 0!=e.params.user_code){var i=this.personService.decodeID(e.params.user_code);n.$or=[{author:i},{asignee:i}],n.type={$ne:"project"},n.isDeleted={$ne:!0},n.status={$gt:-1}}else n.type={$ne:"project"},n.isDeleted={$ne:!0},n.status={$gt:-1};var a=o.find(n);return e.queryPageSort(a).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e,r)})}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:TaskNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new o({type:e.params.type,name:e.params.name,shortname:e.params.shortname,purpose:e.params.purpose,goal:e.params.goal,description:e.params.description,status:e.params.status,deadline:e.params.deadline,timeframe:void 0!=e.params.timeframe?e.params.timeframe:-1,root:void 0!=e.params.root_code?this.decodeID(e.params.root_code):-1,parent:void 0!=e.params.parent_code?this.decodeID(e.params.parent_code):-1,author:e.user.id,asignee:void 0!=e.params.asignee_code?this.personService.decodeID(e.params.asignee_code):-1}).save().then(function(n){return"project"==e.params.type?a.reduce(function(e,t){return e.then(function(){return t.type="kanban",t.parent=n.id,t.author=n.author,new i(t).save()})},Promise.resolve()).then(function(){return t.toJSON(n)}):t.toJSON(n)}).then(function(e){return t.populateModels(e)}).then(function(n){return void 0!=e.params.parent_code?t.actions.breakdown(e,n):(t.notifyModelChanges(e,"created",n),n)})},update:function(e){var t=this;return e.assertModelIsExist(e.t("app:TaskNotFound")),this.validateParams(e),e.params.arrange?this.actions.arrange(e,e.params.arrange):e.params.task?this.actions.arrange2(e):this.collection.findById(e.modelID).exec().then(function(n){return null!=e.params.purpose&&(n.purpose=e.params.purpose),null!=e.params.root_code&&(n.root=t.decodeID(e.params.root_code)),null!=e.params.type&&(n.type=e.params.type),null!=e.params.name&&(n.name=e.params.name),null!=e.params.shortname&&(n.shortname=e.params.shortname),null!=e.params.goal&&(n.goal=e.params.goal),null!=e.params.description&&(n.description=e.params.description),null!=e.params.status&&(n.status=e.params.status),null!=e.params.asignee_code&&(n.asignee=t.personService.decodeID(e.params.asignee_code)),null!=e.params.closingComment&&(n.closingComment=e.params.closingComment),n.save()}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})},remove:function(e){var t=this;return e.assertModelIsExist(e.t("app:TaskNotFound")),this.collection.findById(e.modelID).exec().then(function(e){return e.isDeleted=!0,e.save()}).then(function(){return e.model}).then(function(n){return t.notifyModelChanges(e,"removed",n),n})},breakdown:function(e,t){var n=this;if(void 0===e.params.parent_code)throw this.errorBadRequest(r.ERR_MODEL_NOT_FOUND,e.t("app:TaskNotFound"));var i=this.decodeID(e.params.parent_code),a=this.decodeID(t.code);return this.collection.findById(i).exec().then(function(e){return o.findByIdAndUpdate(e.id,{$addToSet:{children:a}},{new:!0})}).then(function(e){return n.toJSON(e)}).then(function(e){return n.populateModels(e)}).then(function(r){return n.notifyModelChanges(e,"brokedown",{parent:r,child:t}),{parent:r,child:t}})},arrange:function(e,t){var n=this,r=this.decodeID(e.params.code),o=this.decodeID(e.params.target),i=this.decodeID(e.params.targetParent),a=this.decodeID(e.params.parent),s=[];return s.push(this.collection.findById(a).exec().then(function(e){return e.children=e.children.filter(function(e){return e!=r}),e.save()}).then(function(e){return"into"==t?n.collection.findById(o).exec().then(function(t){return t.children.unshift(r),t.save(),[e,t]}):Promise.resolve().then(function(){return a==i?e:n.collection.findById(i).exec()}).then(function(n){var i=0;for(var a in n.children){if(n.children[a]==o)break;i++}return console.log("● before:",n.children),n.children.splice("below"==t?i+1:i,0,r),console.log("● after :",n.children),n.save(),[e,n]})})),s.push(this.collection.findById(r).exec().then(function(e){return e.parent="into"==t?o:i,e.save(),e})),Promise.all(s).then(function(e){return[e[1],e[0][0],e[0][1]]}).then(function(e){return n.toJSON(e)}).then(function(e){return n.populateModels(e)}).then(function(r){return n.notifyModelChanges(e,"arranged",r),"into"==t?{moving:r[0],movingParent:r[1],target:r[2]}:{moving:r[0],movingParent:r[1],targetParent:r[2]}})},arrange2:function(e){var t=this,n=this.decodeID(e.params.task),r=e.params.index;return Promise.resolve().then(function(){var o=e.modelID,i=t.decodeID(e.params.from);return o!=i?t.collection.findById(o).exec().then(function(a){return a.children.splice(r,0,n),a.save().then(function(r){return t.collection.findById(i).exec().then(function(e){return e.children=e.children.filter(function(e){return e!=n}),e.save()}).then(function(r){return t.collection.findById(n).exec().then(function(e){return e.parent=o,e.save()}).then(function(n){return t.groupService.actions.find(e)})})})}):t.collection.findById(o).exec().then(function(o){return o.children=o.children.filter(function(e){return e!=n}),o.children.splice(r,0,n),o.save().then(function(n){return t.groupService.actions.find(e)})})})},check:function(e){var t=this,n=function e(n,r,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{entities:[],errors:[]};return n.reduce(function(n,i){var a=t.decodeID(i.code),s=-1==i.parent?-1:t.decodeID(i.parent),u=-1==i.root?-1:t.decodeID(i.root),c=t.decodeID(r.code);if("project"==r.type&&r.parent&&-1!=r.parent){var l=t.decodeID(r.parent);n.errors.push("project["+c+"] must not have any parent(parent["+l+"])")}return s!=c&&n.errors.push("child["+a+"].parent["+s+"] != parent["+c+"].code"),u!=o&&n.errors.push("child["+a+"].root["+u+"] != root["+o+"].code"),n.entities.push(a),null==i.children||0==i.children.length?n:e(i.children,i,o,n)},i)};return this.collection.find({root:-1}).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(e){return e.reduce(function(e,r){var o=t.decodeID(r.code);return n(r.children,r,o,e)},{entities:[],errors:[]})})}},methods:{validateParams:function(e,t){if((t||e.hasParam("name"))&&e.validateParam("name").trim().notEmpty(e.t("app:TaskNameCannotBeBlank")).end(),(t||e.hasParam("status"))&&e.validateParam("status").isNumber(),e.validateParam("purpose").trim().end(),e.validateParam("goal").trim().end(),e.validateParam("type").trim().end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){this.personService=e.services("persons"),this.groupService=e.services("groups"),this.workService=e.services("works")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\ttasks(limit: Int, offset: Int, sort: String): [Task]\n\t\t\ttask(code: String): Task\n\t\t",types:"\n\t\t\ttype Task {\n\t\t\t\tcode: String!\n\t\t\t\tpurpose: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tgoal: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\ttaskCreate(name: String!, purpose: String, type: String, goal: String, status: Int): Task\n\t\t\ttaskUpdate(code: String!, name: String, purpose: String, type: String, goal: String, status: Int): Task\n\t\t\ttaskRemove(code: String!): Task\n\t\t",resolvers:{Query:{tasks:"find",task:"get"},Mutation:{taskCreate:"create",taskUpdate:"update",taskRemove:"remove"}}}}},function(e,t,n){"use strict";var r=(n(1),n(0)),o=n(3),i=(n(2),n(15)),a=n(146),s=n(26),u=n(27);n(48);e.exports={settings:{name:"works",version:1,namespace:"works",rest:!0,ws:!0,graphql:!0,permission:o.PERM_LOGGEDIN,role:"user",collection:s,modelPropFilter:"code goal title start end actualStart actualEnd description week parent goodSide badSide improvement comments author status asignee lastCommunication createdAt updatedAt",modelPopulates:{comments:"comments"},idEncodes:{parent:"tasks",author:"persons",asignee:"persons"}},actions:{find:{cache:!0,handler:function(e){var t=this,n={};if(e.params.date){var o=i(e.params.date).format(),u=i(e.params.date).add(1,"d").format();n.start={$gte:o,$lt:u};var c=s.find(n);return e.queryPageSort(c).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}var l=e.params.user_code?this.personService.decodeID(e.params.user_code):null;n={asignee:l,week:e.params.week};var d=s.find(n);return e.queryPageSort(d).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return l?t.personService.collection.findById(l).exec().then(function(t){if(t.credentials.access_token){var o=i(e.params.week),s=o.format(),u=o.add(5,"d").format();console.log(s,u);var c=r.authKeys.google.clientID,l=r.authKeys.google.clientSecret,d=a.auth.OAuth2,p=new d(c,l,"/auth/google/callback");p.credentials=t.credentials;var f=a.calendar("v3");return new Promise(function(e,t){f.events.list({auth:p,calendarId:"primary",timeMax:u,timeMin:s,maxResults:10,singleEvents:!0,orderBy:"startTime"},function(n,r){return n?t(n):e(r.data.items)})}).then(function(t){var r=t.map(function(t){return{code:"GOOGLE_CALENDAR",title:t.summary,start:t.start.dateTime,end:t.end.dateTime,week:e.params.week}});return n.concat(r)})}return n}):n})}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:TaskNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new s({title:e.params.title,start:e.params.start,end:e.params.end,week:e.params.week,parent:this.taskService.decodeID(e.params.parent_code),author:e.user.id,asignee:e.user.id}).save().then(function(e){return u.findById(e.parent).exec().then(function(t){null==t.works?t.work=[e.id]:t.works.push(e.id),t.save()}),e}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",n),n})},update:function(e){var t=this;return e.assertModelIsExist(e.t("app:WorkNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then(function(t){return null!=e.params.goal&&(t.goal=e.params.goal),null!=e.params.start&&(t.start=e.params.start),null!=e.params.end&&(t.end=e.params.end),null!=e.params.actualStart&&(t.actualStart=e.params.actualStart),null!=e.params.actualEnd&&(t.actualEnd=e.params.actualEnd),null!=e.params.description&&(t.description=e.params.description),null!=e.params.status&&(t.status=e.params.status),null!=e.params.goodSide&&(t.goodSide=e.params.goodSide),null!=e.params.badSide&&(t.badSide=e.params.badSide),null!=e.params.improvement&&(t.improvement=e.params.improvement),t.save()}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})},remove:function(e){var t=this;return e.assertModelIsExist(e.t("app:WorkNotFound")),s.remove({_id:e.modelID}).then(function(){return e.model}).then(function(n){return u.findById(t.taskService.decodeID(n.parent)).exec().then(function(t){return t.works=t.works.filter(function(t){return t!=e.modelID}),t.save()}).then(function(r){return t.notifyModelChanges(e,"removed",n),n})})}},methods:{validateParams:function(e,t){if((t||e.hasParam("title"))&&e.validateParam("title").trim().notEmpty(e.t("app:WorkTitleCannotBeBlank")).end(),e.hasValidationErrors())throw e.errorBadRequest(o.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){this.taskService=e.services("tasks"),this.personService=e.services("persons")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tworks(limit: Int, offset: Int, sort: String): [Work]\n\t\t\twork(code: String): Work\n\t\t",types:"\n\t\t\ttype Work {\n\t\t\t\tcode: String!\n\t\t\t\tpurpose: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tgoal: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tworkCreate(name: String!, purpose: String, type: String, goal: String, status: Int): Work\n\t\t\tworkUpdate(code: String!, name: String, purpose: String, type: String, goal: String, status: Int): Work\n\t\t\tworkRemove(code: String!): Work\n\t\t",resolvers:{Query:{works:"find",work:"get"},Mutation:{workCreate:"create",workUpdate:"update",workRemove:"remove"}}}}},function(e,t){e.exports=require("googleapis")},function(e,t,n){"use strict";n(0),n(1),n(5);e.exports=function(e,t){e.get("/",function(e,t){null!=e.user?t.render("main",{user:e.user}):t.render("index")}),n(148)(e,t),n(149)(e,t),n(150)(e,t),n(12).registerRoutes(e,t),n(151)(e,t),n(153)(e,t)}},function(e,t,n){"use strict";n(0),n(1);e.exports=function(e,t){e.get("/health",function(e,t){t.sendStatus(200)})}},function(e,t,n){"use strict";function r(){var e={};return o.authKeys&&(o.authKeys.google&&o.authKeys.google.clientID&&(e.google=!0),o.authKeys.facebook&&o.authKeys.facebook.clientID&&(e.facebook=!0),o.authKeys.github&&o.authKeys.github.clientID&&(e.github=!0),o.authKeys.twitter&&o.authKeys.twitter.clientID&&(e.twitter=!0)),Object.keys(e).length>0?e:null}var o=n(0),i=n(1),a=n(3),s=n(20),u=n(22),c=n(49),l=(n(7),n(19),n(16)),d=n(50),p=n(4);e.exports=function(e,t){e.get("/login",function(e,t){if(null!=e.user)return t.redirect("/");t.render("account/login",{socialAuth:r()})}),e.get("/logout",function(e,t){e.logout(),e.session.destroy(),t.redirect("/")}),e.get("/signup",function(e,t){if(!0===o.features.disableSignUp)return t.redirect("/login");t.render("account/signup",{socialAuth:r()})}),e.post("/signup",function(e,t){if(!0===o.features.disableSignUp)return t.redirect("/");e.assert("name",e.t("NameCannotBeEmpty")).notEmpty(),e.assert("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.assert("email",e.t("EmailIsNotValid")).isEmail(),e.sanitize("email").normalizeEmail({remove_dots:!1}),e.body.username||(e.body.username=e.body.email),e.sanitize("passwordless").toBoolean();var n=!0===e.body.passwordless;n||(e.assert("password",e.t("PasswordCannotBeEmpty")).notEmpty(),e.assert("password",e.t("PasswordTooShort")).len(6));var r=e.validationErrors();if(r)return e.flash("error",r),t.redirect("/signup");c.waterfall([function(e){o.features.verificationRequired?u.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))}):e(null,null)},function(t,r){n?u.randomBytes(25,function(e,n){r(e,t,e?null:n.toString("hex"))}):r(null,t,e.body.password)},function(t,r,i){var s=new p({fullName:e.body.name,email:e.body.email,username:e.body.username,password:r,passwordLess:n,roles:[a.ROLE_USER],provider:"local"});t&&o.mailer.enabled?(s.verified=!1,s.verifyToken=t):s.verified=!0,s.save(function(t,n){if(t&&11e3===t.code){var r=void 0;if(t.message.includes(".$"))r=t.message.split(".$")[1];else{if(!t.message.includes("index: "))return e.flash("error",{msg:e.t("UserSaveError")}),void i(t,n);r=t.message.split("index: ")[1]}r=r.split(" dup key")[0],r=r.substring(0,r.lastIndexOf("_")),"email"==r?e.flash("error",{msg:e.t("EmailIsExists")}):e.flash("error",{msg:e.t("UsernameIsExists")})}i(t,n)})},function(n,r){if(!o.mailer.enabled)return i.error("config.mailer not enabled; emailing skipped. Have you configured mailer yet?"),r(null,n);if(n.verified){var a=e.t("mailSubjectWelcome",o);t.render("mail/welcome",{name:n.fullName},function(e,t){if(e)return r(e);d.send(n.email,a,t,function(e,t){r(null,n)})})}else{var s=e.t("mailSubjectActivate",o);t.render("mail/accountVerify",{name:n.fullName,validateLink:"http://"+e.headers.host+"/verify/"+n.verifyToken},function(t,o){if(t)return r(t);d.send(n.email,s,o,function(t,o){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("emailSentVerifyLink")}),r(t,n)})})}}],function(n,r){if(n)return i.error(n),t.redirect("back");r.verified?e.login(r,function(e){return e&&i.error(e),t.redirect("/")}):t.redirect("/login")})}),e.get("/verify/:token",function(e,t){if(e.isAuthenticated())return t.redirect("/");c.waterfall([function(t){p.findOne({verifyToken:e.params.token}).exec(function(n,r){return n?t(n):r?(r.verified=!0,r.verifyToken=void 0,r.lastLogin=Date.now(),void r.save(function(n){if(n)return e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n);t(null,r)})):(e.flash("error",{msg:e.t("AccountVerificationExpired")}),t("Verification is invalid!"))})},function(n,r){if(!o.mailer.enabled){var a="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return i.error(a),r(a,n)}var s=e.t("mailSubjectWelcome",o);t.render("mail/welcome",{name:n.fullName},function(e,t){if(e)return r(e);d.send(n.email,s,t,function(e,t){r(null,n)})})},function(t,n){e.login(t,function(e){n(e,t)})}],function(e){if(e)return i.error(e),t.redirect("/signup");t.redirect("/")})}),e.get("/passwordless/:token",function(e,t){if(e.isAuthenticated())return t.redirect("/");c.waterfall([function(t){p.findOne({passwordLessToken:e.params.token}).exec(function(n,r){return n?t(n):r?(r.passwordLessToken=void 0,r.verified||(r.verified=!0,r.verifyToken=void 0),r.lastLogin=Date.now(),void r.save(function(n){if(n)return e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n);t(null,r)})):(e.flash("error",{msg:e.t("PasswordlessTokenExpired")}),t("Token is invalid!"))})},function(t,n){e.login(t,function(e){n(e,t)})}],function(e){if(e)return i.error(e),t.redirect("/login");t.redirect("/")})}),e.get("/forgot",function(e,t){if(e.isAuthenticated())return t.redirect("/");t.render("account/forgot")}),e.post("/forgot",function(e,t){e.assert("email",e.t("EmailIsNotValid")).isEmail(),e.assert("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.sanitize("email").normalizeEmail({remove_dots:!1});var n=e.validationErrors();if(n)return e.flash("error",n),t.redirect("back");c.waterfall([function(e){u.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))})},function(t,n){p.findOne({email:e.body.email},function(r,o){return o?1!==o.status?(e.flash("error",{msg:e.t("UserDisabledOrDeleted")}),n(e.t("UserDisabledOrDeleted"))):(o.resetPasswordToken=t,o.resetPasswordExpires=Date.now()+36e5,void o.save(function(e){n(e,t,o)})):(e.flash("error",{msg:e.t("EmailNotAssociatedToAccount",e.body)}),n("Email address "+e.body.email+" is not registered!"))})},function(n,r,a){if(!o.mailer.enabled){var s="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return i.error(s),a(s,r)}var u=e.t("mailSubjectResetPassword",o);t.render("mail/passwordReset",{name:r.fullName,resetLink:"http://"+e.headers.host+"/reset/"+n},function(t,n){if(t)return a(t);d.send(r.email,u,n,function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",r)}):e.flash("info",{msg:e.t("emailSentPasswordResetLink",r)}),a(t)})})}],function(e){e&&i.error(e),t.redirect("back")})}),e.get("/reset/:token",function(e,t,n){if(e.isAuthenticated())return t.redirect("/");p.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec(function(r,o){return r?n(r):o?void t.render("account/reset"):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")}),t.redirect("/forgot"))})}),e.post("/reset/:token",function(e,t,n){e.assert("password",e.t("PasswordTooShort")).len(6),e.assert("confirm",e.t("PasswordNotMatched")).equals(e.body.password);var r=e.validationErrors();if(r)return e.flash("error",r),t.redirect("back");c.waterfall([function(t){p.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec(function(n,r){return n?t(n):r?(r.passwordLess&&(r.passwordLess=!1),r.password=e.body.password,r.resetPasswordToken=void 0,r.resetPasswordExpires=void 0,r.lastLogin=Date.now(),void r.save(function(n){if(n)return t(n);e.login(r,function(e){t(e,r)})})):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")}),t("Password reset token is invalid or has expired."))})},function(n,r){if(!o.mailer.enabled){var a="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return i.error(a),r(a,n)}var s=e.t("mailSubjectPasswordChanged",o);t.render("mail/passwordChange",{name:n.fullName},function(t,o){if(t)return r(t);d.send(n.email,s,o,function(t,o){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("PasswordChanged")}),r(t)})})}],function(e){if(e)return i.error(e),t.redirect("back");t.redirect("/")})}),e.get("/generateAPIKey",function(e,t){if(!e.isAuthenticated())return l.json(t,null,l.UNAUTHORIZED);p.findById(e.user.id).exec(function(n,r){return n?l.json(t,null,l.SERVER_ERROR):r?(r.apiKey=s(),void r.save(function(e){return e?l.json(t,null,l.SERVER_ERROR):l.json(t,r)})):l.json(t,null,l.NOT_FOUND,e.t("InvalidUser"))})}),e.get("/unlink/:provider",function(e,t){return e.isAuthenticated()?e.params.provider&&-1!==["facebook","twitter","google","github"].indexOf(e.params.provider)?void p.findById(e.user.id).exec(function(n,r){return n?l.json(t,null,l.SERVER_ERROR):r?(r.socialLinks[e.params.provider]=void 0,void r.save(function(e){return e?l.json(t,null,l.SERVER_ERROR):l.json(t,r)})):l.json(t,null,l.NOT_FOUND,e.t("InvalidUser"))}):l.json(t,null,l.BAD_REQUEST,e.t("InvalidOAuthProvider")):l.json(t,null,l.UNAUTHORIZED)})}},function(e,t,n){"use strict";function r(e,t,n,r){if(e.accepts("json")&&!e.accepts("html")){var o=e.flash();if(o&&o.error&&o.error.length>0){var i=o.error[0].msg;p.json(t,null,r||p.REQUEST_FAILED,i)}else{var a="OK";o&&o.info&&o.info.length>0&&(a=o.info[0].msg),p.json(t,a)}}else n&&(e.session.returnTo&&(n=e.session.returnTo,delete e.session.returnTo),t.redirect(n))}var o=n(0),i=n(1),a=n(22),s=n(49),u=n(7),c=n(19),l=n(50),d=n(4),p=n(16);e.exports=function(e,t){var n=c.Router();n.post("/local",function(e,t,n){e.assert("username",e.t("UsernameCannotBeEmpty")).notEmpty();var c=e.validationErrors();if(c)return e.flash("error",c),r(e,t,"/login",p.BAD_REQUEST);e.body.password?u.authenticate("local",function(n,o,i){if(!o)return e.flash("error",{msg:i.message}),r(e,t,"/login");e.login(o,function(n){if(n)return e.flash("error",{msg:n}),r(e,t,"/login");e.user.lastLogin=Date.now(),e.user.save(function(){e.user.password=void 0,e.user.salt=void 0,r(e,t,"/")})})})(e,t,n):s.waterfall([function(e){a.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))})},function(t,n){var r=e.body.username;d.findOne({$or:[{username:r},{email:r}]},function(o,i){return i?1!==i.status?(e.flash("error",{msg:e.t("UserDisabledOrDeleted")}),n("User '"+r+" is disabled or deleted!")):(i.passwordLessToken=t,void i.save(function(e){n(e,t,i)})):(e.flash("error",{msg:e.t("UsernameIsNotAssociated",{username:r})}),n("Invalid username or email: "+r))})},function(n,r,a){if(!o.mailer.enabled){var s="Trying to send email without config.mailer not enabled; emailing skipped. Have you configured mailer yet?";return i.error(s),a(s,r)}var u=e.t("mailSubjectLogin",o);t.render("mail/passwordLessLogin",{name:r.fullName,loginLink:"http://"+e.headers.host+"/passwordless/"+n},function(t,n){if(t)return a(t);l.send(r.email,u,n,function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",r)}):e.flash("info",{msg:e.t("emailSentWithMagicLink",r)}),a(t)})})}],function(n,o){n&&i.error(n),r(e,t,"back")})}),n.get("/google",u.authenticate("google",{scope:["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/plus.profile.emails.read","https://www.googleapis.com/auth/calendar.readonly"],accessType:"offline",prompt:"consent"})),n.get("/google/callback",u.authenticate("google",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/facebook",u.authenticate("facebook",{scope:["email","user_location"]})),n.get("/facebook/callback",u.authenticate("facebook",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/twitter",u.authenticate("twitter")),n.get("/twitter/callback",u.authenticate("twitter",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/github",u.authenticate("github",{scope:"user:email"})),n.get("/github/callback",u.authenticate("github",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),e.use("/auth",n)}},function(e,t,n){"use strict";var r=n(0),o=n(1),i=(n(14),n(51).graphqlExpress),a=n(51).graphiqlExpress,s=n(152);e.exports=function(e,t){var u=n(12).registerGraphQLSchema();if(u){var c=s.makeExecutableSchema({typeDefs:u.schema,resolvers:u.resolvers,logger:r.isDevMode()?o:void 0});e.use("/graphql",i(function(e){var t=e.query.query||e.body.query;if(t&&t.length>2e3)throw new Error("Query too large.");return{schema:c,context:{req:e,query:t,t:e.t,user:e.user,session:e.session},debug:r.isDevMode(),formatError:function(e){return{status:e.originalError?e.originalError.status:400,type:e.originalError?e.originalError.type:null,message:e.message,locations:e.locations,path:e.path}}}})),e.use("/graphiql",a({endpointURL:"/graphql"}))}}},function(e,t){e.exports=require("graphql-tools")},function(e,t,n){"use strict";var r=n(0),o=n(1),i=n(16);e.exports=function(e,t){e.use(function(e,t,n,r){return e?(o.error(e.stack),n.status(e.status||500),t.accepts("html")?n.render("500",{url:t.originalUrl,error:e}):t.accepts("json")?i.json(n,null,i.SERVER_ERROR,e.message):void 0):r()}),e.use(function(e,t){if(t.status(404),r.isTestMode()||o.warn("404 error! URL:",e.url),e.accepts("html")){var n=new Error("404 Page Not Found");return n.status=404,t.render("404",{url:e.originalUrl,error:n})}if(e.accepts("json"))return i.json(t,null,i.NOT_FOUND)})}},function(e,t){e.exports=require("agenda")},function(e,t,n){"use strict";var r=(n(0),n(1)),o=n(10),i=n(15),a=n(6),s=n(52),u=function(){if(0===a.connection.readyState)return process.exit(0);a.connection.close(function(){return s.stop(function(){return r.info(),r.info(o.bold("---------------------[ Server stopped at %s Uptime: %s ]---------------------------"),i().format("YYYY-MM-DD HH:mm:ss.SSS"),i.duration(1e3*process.uptime()).humanize()),process.exit(0)})})};process.on("SIGINT",u).on("SIGTERM",u)},function(e,t,n){"use strict";var r=n(157),o=n(158),i=n(159),a=n(1);e.exports=function(){var e=o.Gauge,t=r.totalmem(),n=r.freemem(),s=t-n,u=i(n);a.info("CPU:\t\tArch: "+r.arch()+", Cores: "+r.cpus().length),a.info("Memory:\t\t"+e(s,t,20,.8*t,u+" free")),a.info("OS:\t\t"+r.platform()+" ("+r.type()+")")}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("clui")},function(e,t){e.exports=require("pretty-bytes")}]);